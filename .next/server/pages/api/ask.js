"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/ask";
exports.ids = ["pages/api/ask"];
exports.modules = {

/***/ "@google/generative-ai":
/*!****************************************!*\
  !*** external "@google/generative-ai" ***!
  \****************************************/
/***/ ((module) => {

module.exports = import("@google/generative-ai");;

/***/ }),

/***/ "@qdrant/js-client-rest":
/*!*****************************************!*\
  !*** external "@qdrant/js-client-rest" ***!
  \*****************************************/
/***/ ((module) => {

module.exports = import("@qdrant/js-client-rest");;

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "(api)/./lib/qdrant/db.ts":
/*!**************************!*\
  !*** ./lib/qdrant/db.ts ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"client\": () => (/* binding */ client),\n/* harmony export */   \"createCollection\": () => (/* binding */ createCollection),\n/* harmony export */   \"testConnection\": () => (/* binding */ testConnection)\n/* harmony export */ });\n/* harmony import */ var _qdrant_js_client_rest__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @qdrant/js-client-rest */ \"@qdrant/js-client-rest\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_qdrant_js_client_rest__WEBPACK_IMPORTED_MODULE_0__]);\n_qdrant_js_client_rest__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n// Initialize client with support for both local and cloud instances\nconst qdrantUrl = \"https://1555b3af-2ea7-409c-83a3-3a49207ac217.us-east4-0.gcp.cloud.qdrant.io:6333\" || 0;\nconst qdrantApiKey = process.env.QDRANT_API_KEY;\nlet clientConfig;\n// For cloud instances, use the recommended format from documentation\nif (qdrantApiKey) {\n    // Parse the URL to extract host\n    const url = new URL(qdrantUrl);\n    const host = url.hostname;\n    const isHttps = url.protocol === \"https:\";\n    clientConfig = {\n        host: host,\n        port: null,\n        https: isHttps,\n        apiKey: qdrantApiKey\n    };\n    console.log(`Connecting to Qdrant Cloud at ${host} (HTTPS: ${isHttps})`);\n} else {\n    // For local instances without API key\n    clientConfig = {\n        url: qdrantUrl\n    };\n    console.log(`Connecting to local Qdrant at ${qdrantUrl}`);\n}\nconst client = new _qdrant_js_client_rest__WEBPACK_IMPORTED_MODULE_0__.QdrantClient(clientConfig);\n\n// Test Qdrant connection\nasync function testConnection() {\n    try {\n        // Use getCollections as a simple health check\n        await client.getCollections();\n        console.log(\"Qdrant connection successful\");\n        return true;\n    } catch (error) {\n        console.error(\"Qdrant connection failed:\", error);\n        return false;\n    }\n}\nasync function createCollection(name = \"my_collection\", dimension = 768) {\n    try {\n        // First test the connection\n        const isConnected = await testConnection();\n        if (!isConnected) {\n            throw new Error(\"Cannot connect to Qdrant database. Please check your configuration.\");\n        }\n        // Check if collection already exists\n        try {\n            await client.getCollection(name);\n            console.log(`Collection \"${name}\" already exists`);\n            return;\n        } catch (error) {\n            // Collection doesn't exist, create it\n            console.log(`Collection \"${name}\" does not exist, creating...`);\n            // Check if it's a different error than \"not found\"\n            if (error.status && error.status !== 404) {\n                console.error(\"Unexpected error checking collection:\", error);\n                throw error;\n            }\n        }\n        await client.createCollection(name, {\n            vectors: {\n                size: dimension,\n                distance: \"Cosine\"\n            }\n        });\n        console.log(`Collection \"${name}\" created successfully with dimension ${dimension}`);\n    } catch (error1) {\n        console.error(`Error creating collection \"${name}\":`, error1);\n        // Provide more specific error messages\n        if (error1.message?.includes(\"authentication\") || error1.status === 401 || error1.status === 403) {\n            throw new Error(\"Authentication failed. Please check your QDRANT_API_KEY and QDRANT_URL.\");\n        } else if (error1.message?.includes(\"connection\") || error1.code === \"ECONNREFUSED\") {\n            throw new Error(\"Cannot connect to Qdrant. Please check your QDRANT_URL.\");\n        } else {\n            throw error1;\n        }\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q2xDTSxPQUFPLEVBQUU7Z0JBQ1BDLElBQUksRUFBRU4sU0FBUztnQkFDZk8sUUFBUSxFQUFFLFFBQVE7YUFDbkI7U0FDRixDQUFDLENBQUM7UUFFSGYsT0FBTyxDQUFDQyxHQUFHLENBQ1QsQ0FBQyxZQUFZLEVBQUVNLElBQUksQ0FBQyxzQ0FBc0MsRUFBRUMsU0FBUyxDQUFDLENBQUMsQ0FDeEUsQ0FBQztJQUNKLEVBQUUsT0FBT0gsTUFBSyxFQUFPO1FBQ25CTCxPQUFPLENBQUNLLEtBQUssQ0FBQyxDQUFDLDJCQUEyQixFQUFFRSxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUVGLE1BQUssQ0FBQyxDQUFDO1FBRTdELHVDQUF1QztRQUN2QyxJQUNFQSxNQUFLLENBQUNXLE9BQU8sRUFBRUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLElBQ3pDWixNQUFLLENBQUNPLE1BQU0sS0FBSyxHQUFHLElBQ3BCUCxNQUFLLENBQUNPLE1BQU0sS0FBSyxHQUFHLEVBQ3BCO1lBQ0EsTUFBTSxJQUFJRixLQUFLLENBQ2IseUVBQXlFLENBQzFFLENBQUM7UUFDSixPQUFPLElBQ0xMLE1BQUssQ0FBQ1csT0FBTyxFQUFFQyxRQUFRLENBQUMsWUFBWSxDQUFDLElBQ3JDWixNQUFLLENBQUNhLElBQUksS0FBSyxjQUFjLEVBQzdCO1lBQ0EsTUFBTSxJQUFJUixLQUFLLENBQ2IseURBQXlELENBQzFELENBQUM7UUFDSixPQUFPO1lBQ0wsTUFBTUwsTUFBSyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7QUFDSCxDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8veWVhcm4vLi9saWIvcWRyYW50L2RiLnRzPzM5NjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUWRyYW50Q2xpZW50IH0gZnJvbSBcIkBxZHJhbnQvanMtY2xpZW50LXJlc3RcIjtcblxuLy8gSW5pdGlhbGl6ZSBjbGllbnQgd2l0aCBzdXBwb3J0IGZvciBib3RoIGxvY2FsIGFuZCBjbG91ZCBpbnN0YW5jZXNcbmNvbnN0IHFkcmFudFVybCA9IHByb2Nlc3MuZW52LlFEUkFOVF9VUkwgfHwgXCJodHRwOi8vbG9jYWxob3N0OjYzMzNcIjtcbmNvbnN0IHFkcmFudEFwaUtleSA9IHByb2Nlc3MuZW52LlFEUkFOVF9BUElfS0VZO1xuXG5sZXQgY2xpZW50Q29uZmlnOiBhbnk7XG5cbi8vIEZvciBjbG91ZCBpbnN0YW5jZXMsIHVzZSB0aGUgcmVjb21tZW5kZWQgZm9ybWF0IGZyb20gZG9jdW1lbnRhdGlvblxuaWYgKHFkcmFudEFwaUtleSkge1xuICAvLyBQYXJzZSB0aGUgVVJMIHRvIGV4dHJhY3QgaG9zdFxuICBjb25zdCB1cmwgPSBuZXcgVVJMKHFkcmFudFVybCk7XG4gIGNvbnN0IGhvc3QgPSB1cmwuaG9zdG5hbWU7XG4gIGNvbnN0IGlzSHR0cHMgPSB1cmwucHJvdG9jb2wgPT09IFwiaHR0cHM6XCI7XG5cbiAgY2xpZW50Q29uZmlnID0ge1xuICAgIGhvc3Q6IGhvc3QsXG4gICAgcG9ydDogbnVsbCwgLy8gVGhpcyBpcyBjcml0aWNhbCBmb3IgY2xvdWQgaW5zdGFuY2VzIC0gcHJldmVudHMgOjYzMzMgYmVpbmcgYXBwZW5kZWRcbiAgICBodHRwczogaXNIdHRwcyxcbiAgICBhcGlLZXk6IHFkcmFudEFwaUtleSxcbiAgfTtcblxuICBjb25zb2xlLmxvZyhgQ29ubmVjdGluZyB0byBRZHJhbnQgQ2xvdWQgYXQgJHtob3N0fSAoSFRUUFM6ICR7aXNIdHRwc30pYCk7XG59IGVsc2Uge1xuICAvLyBGb3IgbG9jYWwgaW5zdGFuY2VzIHdpdGhvdXQgQVBJIGtleVxuICBjbGllbnRDb25maWcgPSB7XG4gICAgdXJsOiBxZHJhbnRVcmwsXG4gIH07XG5cbiAgY29uc29sZS5sb2coYENvbm5lY3RpbmcgdG8gbG9jYWwgUWRyYW50IGF0ICR7cWRyYW50VXJsfWApO1xufVxuXG5jb25zdCBjbGllbnQgPSBuZXcgUWRyYW50Q2xpZW50KGNsaWVudENvbmZpZyk7XG5cbmV4cG9ydCB7IGNsaWVudCB9O1xuXG4vLyBUZXN0IFFkcmFudCBjb25uZWN0aW9uXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdGVzdENvbm5lY3Rpb24oKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHRyeSB7XG4gICAgLy8gVXNlIGdldENvbGxlY3Rpb25zIGFzIGEgc2ltcGxlIGhlYWx0aCBjaGVja1xuICAgIGF3YWl0IGNsaWVudC5nZXRDb2xsZWN0aW9ucygpO1xuICAgIGNvbnNvbGUubG9nKFwiUWRyYW50IGNvbm5lY3Rpb24gc3VjY2Vzc2Z1bFwiKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiUWRyYW50IGNvbm5lY3Rpb24gZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb2xsZWN0aW9uKFxuICBuYW1lOiBzdHJpbmcgPSBcIm15X2NvbGxlY3Rpb25cIixcbiAgZGltZW5zaW9uOiBudW1iZXIgPSA3Njhcbik6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIC8vIEZpcnN0IHRlc3QgdGhlIGNvbm5lY3Rpb25cbiAgICBjb25zdCBpc0Nvbm5lY3RlZCA9IGF3YWl0IHRlc3RDb25uZWN0aW9uKCk7XG4gICAgaWYgKCFpc0Nvbm5lY3RlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkNhbm5vdCBjb25uZWN0IHRvIFFkcmFudCBkYXRhYmFzZS4gUGxlYXNlIGNoZWNrIHlvdXIgY29uZmlndXJhdGlvbi5cIlxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBjb2xsZWN0aW9uIGFscmVhZHkgZXhpc3RzXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGNsaWVudC5nZXRDb2xsZWN0aW9uKG5hbWUpO1xuICAgICAgY29uc29sZS5sb2coYENvbGxlY3Rpb24gXCIke25hbWV9XCIgYWxyZWFkeSBleGlzdHNgKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyBDb2xsZWN0aW9uIGRvZXNuJ3QgZXhpc3QsIGNyZWF0ZSBpdFxuICAgICAgY29uc29sZS5sb2coYENvbGxlY3Rpb24gXCIke25hbWV9XCIgZG9lcyBub3QgZXhpc3QsIGNyZWF0aW5nLi4uYCk7XG5cbiAgICAgIC8vIENoZWNrIGlmIGl0J3MgYSBkaWZmZXJlbnQgZXJyb3IgdGhhbiBcIm5vdCBmb3VuZFwiXG4gICAgICBpZiAoZXJyb3Iuc3RhdHVzICYmIGVycm9yLnN0YXR1cyAhPT0gNDA0KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmV4cGVjdGVkIGVycm9yIGNoZWNraW5nIGNvbGxlY3Rpb246XCIsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgfVxuXG4gICAgYXdhaXQgY2xpZW50LmNyZWF0ZUNvbGxlY3Rpb24obmFtZSwge1xuICAgICAgdmVjdG9yczoge1xuICAgICAgICBzaXplOiBkaW1lbnNpb24sXG4gICAgICAgIGRpc3RhbmNlOiBcIkNvc2luZVwiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYENvbGxlY3Rpb24gXCIke25hbWV9XCIgY3JlYXRlZCBzdWNjZXNzZnVsbHkgd2l0aCBkaW1lbnNpb24gJHtkaW1lbnNpb259YFxuICAgICk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKGBFcnJvciBjcmVhdGluZyBjb2xsZWN0aW9uIFwiJHtuYW1lfVwiOmAsIGVycm9yKTtcblxuICAgIC8vIFByb3ZpZGUgbW9yZSBzcGVjaWZpYyBlcnJvciBtZXNzYWdlc1xuICAgIGlmIChcbiAgICAgIGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKFwiYXV0aGVudGljYXRpb25cIikgfHxcbiAgICAgIGVycm9yLnN0YXR1cyA9PT0gNDAxIHx8XG4gICAgICBlcnJvci5zdGF0dXMgPT09IDQwM1xuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkF1dGhlbnRpY2F0aW9uIGZhaWxlZC4gUGxlYXNlIGNoZWNrIHlvdXIgUURSQU5UX0FQSV9LRVkgYW5kIFFEUkFOVF9VUkwuXCJcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKFwiY29ubmVjdGlvblwiKSB8fFxuICAgICAgZXJyb3IuY29kZSA9PT0gXCJFQ09OTlJFRlVTRURcIlxuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkNhbm5vdCBjb25uZWN0IHRvIFFkcmFudC4gUGxlYXNlIGNoZWNrIHlvdXIgUURSQU5UX1VSTC5cIlxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiUWRyYW50Q2xpZW50IiwicWRyYW50VXJsIiwicHJvY2VzcyIsImVudiIsIlFEUkFOVF9VUkwiLCJxZHJhbnRBcGlLZXkiLCJRRFJBTlRfQVBJX0tFWSIsImNsaWVudENvbmZpZyIsInVybCIsIlVSTCIsImhvc3QiLCJob3N0bmFtZSIsImlzSHR0cHMiLCJwcm90b2NvbCIsInBvcnQiLCJodHRwcyIsImFwaUtleSIsImNvbnNvbGUiLCJsb2ciLCJjbGllbnQiLCJ0ZXN0Q29ubmVjdGlvbiIsImdldENvbGxlY3Rpb25zIiwiZXJyb3IiLCJjcmVhdGVDb2xsZWN0aW9uIiwibmFtZSIsImRpbWVuc2lvbiIsImlzQ29ubmVjdGVkIiwiRXJyb3IiLCJnZXRDb2xsZWN0aW9uIiwic3RhdHVzIiwidmVjdG9ycyIsInNpemUiLCJkaXN0YW5jZSIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsImNvZGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/qdrant/db.ts\n");

/***/ }),

/***/ "(api)/./lib/qdrant/nlp-query.ts":
/*!*********************************!*\
  !*** ./lib/qdrant/nlp-query.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"processNaturalQuery\": () => (/* binding */ processNaturalQuery)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"openai\");\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @google/generative-ai */ \"@google/generative-ai\");\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./db */ \"(api)/./lib/qdrant/db.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_0__, _google_generative_ai__WEBPACK_IMPORTED_MODULE_1__, _db__WEBPACK_IMPORTED_MODULE_2__]);\n([openai__WEBPACK_IMPORTED_MODULE_0__, _google_generative_ai__WEBPACK_IMPORTED_MODULE_1__, _db__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\nconst genAI = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_1__.GoogleGenerativeAI(process.env.GEMINI_API_KEY || \"\");\nasync function processNaturalQuery(collection, question, provider = \"openai\") {\n    const startTime = Date.now();\n    try {\n        // Step 1: Understand the intent using LLM\n        const intent = await parseQueryIntent(question, provider);\n        // Step 2: Use extracted collection name if available and no explicit collection provided\n        const finalCollection = collection || intent.extractedCollection || null;\n        // Step 3: Execute the appropriate operation (database or collection level)\n        const result = await executeQuery(finalCollection, intent);\n        // Step 4: Generate natural language response\n        const answer = await generateResponse(question, intent, result, provider);\n        const execution_time_ms = Date.now() - startTime;\n        return {\n            answer,\n            query_type: intent.type,\n            data: result,\n            execution_time_ms\n        };\n    } catch (error) {\n        console.error(\"Error processing natural query:\", error);\n        // Create fallback response even if everything fails\n        const fallbackAnswer = \"I encountered an issue processing your query, but I'm using pattern matching to help. \" + generateFallbackResponse(question, inferIntentFromQuestion(question), {\n            count: 0\n        });\n        return {\n            answer: fallbackAnswer,\n            query_type: \"fallback\",\n            data: null,\n            execution_time_ms: Date.now() - startTime\n        };\n    }\n}\nasync function parseQueryIntent(question, provider) {\n    // First try simple pattern matching as fallback\n    const fallbackIntent = inferIntentFromQuestion(question);\n    // If we don't have API keys, use fallback\n    if (!process.env.OPENAI_API_KEY && !process.env.GEMINI_API_KEY) {\n        console.log(\"No API keys available, using pattern matching fallback\");\n        return fallbackIntent;\n    }\n    const systemPrompt = `You are a query analyzer for a vector database system. Parse the user's question and return a JSON object with the query intent.\n\nThe system contains multiple collections, each with image data with these fields:\n- name (artist name)\n- file_name (image filename)\n- image_url (URL to image)\n- url (style URL)\n\nAvailable query types:\n- \"count\": count items (e.g., \"how many artists\", \"count images\")\n- \"search\": find specific items (e.g., \"find Chris Dyer images\")\n- \"list\": list unique values (e.g., \"list all artists\")\n- \"filter\": filter by criteria (e.g., \"images with .jpeg extension\")\n- \"describe\": get general info (e.g., \"describe this collection\")\n- \"collections\": collection management (e.g., \"what collections exist\", \"list collections\")\n- \"database\": database-level queries (e.g., \"describe the database\", \"how many collections\")\n\nAvailable scopes:\n- \"collection\": query operates on a specific collection\n- \"database\": query operates on the entire database\n\nReturn ONLY a JSON object in this format:\n{\n  \"type\": \"count|search|list|filter|describe|collections|database\",\n  \"target\": \"what to count/search/list (e.g., 'artists', 'images', 'collections')\",\n  \"filter\": {\"field\": \"value\"} or null,\n  \"limit\": number or null,\n  \"scope\": \"collection|database\",\n  \"extractedCollection\": \"collection_name_if_mentioned_in_query\" or null\n}\n\nExamples:\n- \"How many artists?\" → {\"type\": \"count\", \"target\": \"artists\", \"filter\": null, \"limit\": null, \"scope\": \"database\", \"extractedCollection\": null}\n- \"How many artists in midjourneysample?\" → {\"type\": \"count\", \"target\": \"artists\", \"filter\": null, \"limit\": null, \"scope\": \"collection\", \"extractedCollection\": \"midjourneysample\"}\n- \"What collections exist?\" → {\"type\": \"collections\", \"target\": \"list\", \"filter\": null, \"limit\": null, \"scope\": \"database\", \"extractedCollection\": null}\n- \"How many collections are there?\" → {\"type\": \"count\", \"target\": \"collections\", \"filter\": null, \"limit\": null, \"scope\": \"database\", \"extractedCollection\": null}\n- \"Describe the database\" → {\"type\": \"database\", \"target\": \"overview\", \"filter\": null, \"limit\": null, \"scope\": \"database\", \"extractedCollection\": null}\n- \"Find Chris Dyer images across all collections\" → {\"type\": \"search\", \"target\": \"images\", \"filter\": {\"name\": \"Chris Dyer\"}, \"limit\": 10, \"scope\": \"database\", \"extractedCollection\": null}\n- \"How many vectors in test_collection?\" → {\"type\": \"count\", \"target\": \"total\", \"filter\": null, \"limit\": null, \"scope\": \"collection\", \"extractedCollection\": \"test_collection\"}`;\n    try {\n        let response;\n        if (provider === \"gemini\" && process.env.GEMINI_API_KEY) {\n            const model = genAI.getGenerativeModel({\n                model: \"gemini-2.0-flash\"\n            });\n            const result = await model.generateContent([\n                {\n                    text: systemPrompt\n                },\n                {\n                    text: `Question: \"${question}\"`\n                }, \n            ]);\n            response = result.response.text();\n        } else if (provider === \"openai\" && process.env.OPENAI_API_KEY) {\n            const completion = await openai.chat.completions.create({\n                model: \"gpt-3.5-turbo\",\n                messages: [\n                    {\n                        role: \"system\",\n                        content: systemPrompt\n                    },\n                    {\n                        role: \"user\",\n                        content: `Question: \"${question}\"`\n                    }, \n                ],\n                temperature: 0\n            });\n            response = completion.choices[0].message.content || \"{}\";\n        } else {\n            throw new Error(\"No valid API key for the specified provider\");\n        }\n        // Extract JSON from response (in case there's extra text)\n        const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\n        const jsonStr = jsonMatch ? jsonMatch[0] : response;\n        return JSON.parse(jsonStr);\n    } catch (e) {\n        // Fallback parsing\n        console.warn(\"Failed to parse LLM response, using fallback:\", e);\n        return fallbackIntent;\n    }\n}\nfunction inferIntentFromQuestion(question) {\n    const q = question.toLowerCase();\n    // Try to extract collection name from the question\n    const extractedCollection = extractCollectionFromQuestion(question);\n    // Database-level queries\n    if (q.includes(\"collections\") || q.includes(\"database\")) {\n        if (q.includes(\"how many\") || q.includes(\"count\")) {\n            return {\n                type: \"count\",\n                target: \"collections\",\n                scope: \"database\"\n            };\n        }\n        if (q.includes(\"list\") || q.includes(\"what\") || q.includes(\"show\")) {\n            return {\n                type: \"collections\",\n                target: \"list\",\n                scope: \"database\"\n            };\n        }\n        if (q.includes(\"describe\")) {\n            return {\n                type: \"database\",\n                target: \"overview\",\n                scope: \"database\"\n            };\n        }\n    }\n    // Collection-level queries (existing logic)\n    if (q.includes(\"how many\") || q.includes(\"count\")) {\n        if (q.includes(\"artist\")) {\n            return {\n                type: \"count\",\n                target: \"artists\",\n                scope: extractedCollection ? \"collection\" : \"database\",\n                ...extractedCollection && {\n                    extractedCollection\n                }\n            };\n        }\n        if (q.includes(\"vector\") || q.includes(\"image\") || q.includes(\"item\")) {\n            return {\n                type: \"count\",\n                target: \"total\",\n                scope: extractedCollection ? \"collection\" : \"database\",\n                ...extractedCollection && {\n                    extractedCollection\n                }\n            };\n        }\n        return {\n            type: \"count\",\n            target: \"total\",\n            scope: extractedCollection ? \"collection\" : \"database\",\n            ...extractedCollection && {\n                extractedCollection\n            }\n        };\n    }\n    if (q.includes(\"find\") || q.includes(\"search\")) {\n        // Check if it's across all collections\n        const scope = q.includes(\"all collections\") || q.includes(\"across\") ? \"database\" : extractedCollection ? \"collection\" : \"database\";\n        // Try to extract artist name\n        const artistMatch = question.match(/(?:by|from|of)\\s+([A-Z][a-z]+\\s+[A-Z][a-z]+)/i);\n        if (artistMatch) {\n            return {\n                type: \"search\",\n                target: \"images\",\n                filter: {\n                    name: artistMatch[1]\n                },\n                limit: 10,\n                scope,\n                ...extractedCollection && {\n                    extractedCollection\n                }\n            };\n        }\n        return {\n            type: \"search\",\n            target: \"images\",\n            limit: 10,\n            scope,\n            ...extractedCollection && {\n                extractedCollection\n            }\n        };\n    }\n    if (q.includes(\"list\") || q.includes(\"show\")) {\n        if (q.includes(\"artist\")) {\n            return {\n                type: \"list\",\n                target: \"artists\",\n                scope: extractedCollection ? \"collection\" : \"database\",\n                ...extractedCollection && {\n                    extractedCollection\n                }\n            };\n        }\n        return {\n            type: \"list\",\n            target: \"images\",\n            limit: 20,\n            scope: extractedCollection ? \"collection\" : \"database\",\n            ...extractedCollection && {\n                extractedCollection\n            }\n        };\n    }\n    if (q.includes(\"describe\")) {\n        return {\n            type: \"describe\",\n            target: extractedCollection ? \"collection\" : \"database\",\n            scope: extractedCollection ? \"collection\" : \"database\",\n            ...extractedCollection && {\n                extractedCollection\n            }\n        };\n    }\n    return {\n        type: \"describe\",\n        target: \"collection\",\n        scope: extractedCollection ? \"collection\" : \"database\",\n        ...extractedCollection && {\n            extractedCollection\n        }\n    };\n}\n// New function to extract collection names from natural language\nfunction extractCollectionFromQuestion(question) {\n    const q = question.toLowerCase();\n    // Common patterns for mentioning collections\n    const patterns = [\n        // \"in [collection]\" or \"from [collection]\"\n        /(?:in|from)\\s+([a-zA-Z][a-zA-Z0-9_-]*)/g,\n        // \"[collection] collection\"\n        /([a-zA-Z][a-zA-Z0-9_-]*)\\s+collection/g,\n        // \"collection [collection]\"\n        /collection\\s+([a-zA-Z][a-zA-Z0-9_-]*)/g, \n    ];\n    for (const pattern of patterns){\n        const matches = [\n            ...q.matchAll(pattern)\n        ];\n        for (const match of matches){\n            const candidate = match[1];\n            // Filter out common words that aren't collection names\n            if (![\n                \"the\",\n                \"this\",\n                \"that\",\n                \"my\",\n                \"your\",\n                \"our\",\n                \"their\",\n                \"all\",\n                \"some\",\n                \"any\",\n                \"each\",\n                \"every\", \n            ].includes(candidate)) {\n                return candidate;\n            }\n        }\n    }\n    // Look for specific common collection names that might appear without prepositions\n    const commonCollectionNames = [\n        \"midjourneysample\",\n        \"test_collection\",\n        \"my_docs\",\n        \"test_small\",\n        \"new_test_yearn\",\n        \"docs_openai\",\n        \"docs_gemini\", \n    ];\n    for (const name of commonCollectionNames){\n        if (q.includes(name)) {\n            return name;\n        }\n    }\n    return undefined;\n}\nasync function executeQuery(collection, intent) {\n    if (intent.scope === \"database\") {\n        return await executeDatabaseQuery(intent);\n    } else {\n        // Collection-level query - require collection name\n        if (!collection) {\n            throw new Error(\"Collection name is required for collection-level queries\");\n        }\n        return await executeCollectionQuery(collection, intent);\n    }\n}\nasync function executeDatabaseQuery(intent) {\n    switch(intent.type){\n        case \"count\":\n            if (intent.target === \"collections\") {\n                return await countCollections();\n            }\n            if (intent.target === \"artists\") {\n                return await countArtistsAcrossDatabase();\n            }\n            if (intent.target === \"total\") {\n                return await countTotalVectorsAcrossDatabase();\n            }\n            break;\n        case \"collections\":\n            return await listCollections();\n        case \"database\":\n            return await describeDatabaseInfo();\n        case \"search\":\n            if (intent.filter) {\n                return await searchAcrossCollections(intent.filter, intent.limit || 10);\n            }\n            break;\n        case \"list\":\n            if (intent.target === \"artists\") {\n                return await listArtistsAcrossDatabase(intent.limit || 50);\n            }\n            break;\n        default:\n            throw new Error(`Database-level query type '${intent.type}' not implemented yet`);\n    }\n}\nasync function executeCollectionQuery(collection, intent) {\n    switch(intent.type){\n        case \"count\":\n            if (intent.target === \"artists\") {\n                return await countUniqueArtists(collection);\n            } else {\n                return await countTotal(collection);\n            }\n        case \"search\":\n            return await searchImages(collection, intent.filter, intent.limit || 10);\n        case \"list\":\n            if (intent.target === \"artists\") {\n                return await listUniqueArtists(collection, intent.limit || 50);\n            } else {\n                return await listImages(collection, intent.limit || 20);\n            }\n        case \"filter\":\n            return await filterImages(collection, intent.filter, intent.limit || 20);\n        case \"describe\":\n            return await describeCollection(collection);\n        default:\n            throw new Error(`Unknown collection-level query type: ${intent.type}`);\n    }\n}\n// New database-level functions\nasync function countCollections() {\n    const collectionsInfo = await _db__WEBPACK_IMPORTED_MODULE_2__.client.getCollections();\n    const collections = collectionsInfo.collections.map((c)=>c.name);\n    return {\n        count: collections.length,\n        collections: collections\n    };\n}\nasync function listCollections() {\n    const collectionsInfo = await _db__WEBPACK_IMPORTED_MODULE_2__.client.getCollections();\n    const collections = collectionsInfo.collections;\n    // Get detailed info for each collection using actual count\n    const detailedCollections = await Promise.all(collections.map(async (collection)=>{\n        try {\n            // Use the same count method that works for individual queries\n            const countResult = await _db__WEBPACK_IMPORTED_MODULE_2__.client.count(collection.name, {});\n            return {\n                name: collection.name,\n                vectors_count: countResult.count || 0\n            };\n        } catch (error) {\n            console.warn(`Failed to count vectors in collection ${collection.name}:`, error);\n            return {\n                name: collection.name,\n                vectors_count: 0\n            };\n        }\n    }));\n    return {\n        collections: detailedCollections\n    };\n}\nasync function describeDatabaseInfo() {\n    const collectionsData = await listCollections();\n    const totalVectors = collectionsData.collections.reduce((sum, col)=>sum + (col.vectors_count || 0), 0);\n    return {\n        total_collections: collectionsData.collections.length,\n        total_vectors: totalVectors,\n        collections: collectionsData.collections\n    };\n}\nasync function searchAcrossCollections(filter, limit) {\n    const collectionsData = await listCollections();\n    const allResults = [];\n    // Search each collection\n    for (const collection of collectionsData.collections){\n        try {\n            const results = await searchImages(collection.name, filter, limit);\n            if (results.images && results.images.length > 0) {\n                allResults.push({\n                    collection: collection.name,\n                    count: results.count,\n                    images: results.images\n                });\n            }\n        } catch (error) {\n            console.warn(`Failed to search collection ${collection.name}:`, error);\n        }\n    }\n    const totalCount = allResults.reduce((sum, result)=>sum + result.count, 0);\n    return {\n        total_count: totalCount,\n        collections_searched: collectionsData.collections.length,\n        results_by_collection: allResults\n    };\n}\n// Existing collection-level functions remain the same\nasync function countTotal(collection) {\n    const response = await _db__WEBPACK_IMPORTED_MODULE_2__.client.count(collection, {});\n    return {\n        count: response.count\n    };\n}\nasync function countUniqueArtists(collection) {\n    const response = await _db__WEBPACK_IMPORTED_MODULE_2__.client.scroll(collection, {\n        limit: 1000,\n        with_payload: true,\n        with_vector: false\n    });\n    const artists = new Set(response.points.map((point)=>point.payload?.name).filter(Boolean));\n    return {\n        count: artists.size,\n        artists: Array.from(artists).slice(0, 20)\n    };\n}\nasync function searchImages(collection, filter, limit) {\n    const response = await _db__WEBPACK_IMPORTED_MODULE_2__.client.scroll(collection, {\n        limit: 1000,\n        with_payload: true,\n        with_vector: false\n    });\n    let filteredPoints = response.points;\n    if (filter) {\n        filteredPoints = response.points.filter((point)=>{\n            return Object.entries(filter).every(([key, value])=>{\n                return point.payload?.[key] === value;\n            });\n        });\n    }\n    const limitedPoints = filteredPoints.slice(0, limit);\n    return {\n        count: limitedPoints.length,\n        images: limitedPoints\n    };\n}\nasync function listUniqueArtists(collection, limit) {\n    const response = await _db__WEBPACK_IMPORTED_MODULE_2__.client.scroll(collection, {\n        limit,\n        with_payload: true,\n        with_vector: false\n    });\n    const artists = new Set(response.points.map((point)=>point.payload?.name).filter(Boolean));\n    return {\n        artists: Array.from(artists)\n    };\n}\nasync function listImages(collection, limit) {\n    const response = await _db__WEBPACK_IMPORTED_MODULE_2__.client.scroll(collection, {\n        limit,\n        with_payload: true,\n        with_vector: false\n    });\n    return {\n        count: response.points.length,\n        images: response.points.map((point)=>({\n                id: point.id,\n                artist: point.payload?.name,\n                filename: point.payload?.file_name\n            }))\n    };\n}\nasync function filterImages(collection, filter, limit) {\n    return await searchImages(collection, filter, limit);\n}\nasync function describeCollection(collection) {\n    const totalCount = await countTotal(collection);\n    const artistsData = await countUniqueArtists(collection);\n    const sampleImages = await listImages(collection, 5);\n    return {\n        total_images: totalCount.count,\n        unique_artists: artistsData.count,\n        sample_artists: artistsData.artists.slice(0, 10),\n        sample_images: sampleImages.images\n    };\n}\nasync function generateResponse(question, intent, data, provider) {\n    const fallbackResponse = generateFallbackResponse(question, intent, data);\n    if (!process.env.OPENAI_API_KEY && !process.env.GEMINI_API_KEY) {\n        return fallbackResponse;\n    }\n    const systemPrompt = `You are a helpful assistant that explains vector database query results in natural language.\n  \nThe user asked: \"${question}\"\nThe query type was: ${intent.type}\nThe query scope was: ${intent.scope}\nThe data returned is: ${JSON.stringify(data, null, 2)}\n\nProvide a concise, natural language response that directly answers the user's question. Be specific with numbers and names when available.`;\n    try {\n        let response;\n        if (provider === \"gemini\" && process.env.GEMINI_API_KEY) {\n            const model = genAI.getGenerativeModel({\n                model: \"gemini-2.0-flash\"\n            });\n            const result = await model.generateContent(systemPrompt);\n            response = result.response.text();\n        } else if (provider === \"openai\" && process.env.OPENAI_API_KEY) {\n            const completion = await openai.chat.completions.create({\n                model: \"gpt-3.5-turbo\",\n                messages: [\n                    {\n                        role: \"system\",\n                        content: systemPrompt\n                    }\n                ],\n                temperature: 0.3,\n                max_tokens: 200\n            });\n            response = completion.choices[0].message.content || fallbackResponse;\n        } else {\n            return fallbackResponse;\n        }\n        return response.trim();\n    } catch (error) {\n        console.warn(\"Failed to generate LLM response, using fallback:\", error);\n        return fallbackResponse;\n    }\n}\nfunction generateFallbackResponse(question, intent, data) {\n    if (intent.scope === \"database\") {\n        switch(intent.type){\n            case \"count\":\n                if (intent.target === \"collections\") {\n                    return `I found ${data.count || 0} collections in the database: ${data.collections?.join(\", \") || \"None found\"}.`;\n                }\n                if (intent.target === \"artists\") {\n                    return `I found ${data.count || 0} unique artists across all collections. Some of them include: ${data.artists?.slice(0, 5).join(\", \") || \"No artists found\"}.`;\n                }\n                if (intent.target === \"total\") {\n                    return `The database contains ${data.count || 0} total vectors across all collections.`;\n                }\n                break;\n            case \"collections\":\n                return `The database contains ${data.collections?.length || 0} collections: ${data.collections?.map((c)=>`${c.name} (${c.vectors_count || 0} vectors)`).join(\", \") || \"None found\"}.`;\n            case \"database\":\n                return `The database contains ${data.total_collections || 0} collections with a total of ${data.total_vectors || 0} vectors.`;\n            case \"search\":\n                return `I searched across ${data.collections_searched || 0} collections and found ${data.total_count || 0} matching items.`;\n            case \"list\":\n                if (intent.target === \"artists\") {\n                    return `I found ${data.artists?.length || 0} unique artists across all collections: ${data.artists?.slice(0, 10).join(\", \") || \"No artists found\"}.`;\n                }\n                break;\n        }\n    }\n    // Collection-level responses (existing logic)\n    switch(intent.type){\n        case \"count\":\n            if (intent.target === \"artists\") {\n                return `I found ${data.count || 0} unique artists in the collection. Some of them include: ${data.artists?.slice(0, 5).join(\", \") || \"No artists found\"}.`;\n            } else {\n                return `The collection contains ${data.count || 0} total images.`;\n            }\n        case \"search\":\n        case \"filter\":\n            return `I found ${data.count || 0} images matching your criteria.`;\n        case \"list\":\n            if (intent.target === \"artists\") {\n                return `Here are the artists in the collection: ${data.artists?.slice(0, 10).join(\", \") || \"No artists found\"}${data.artists?.length > 10 ? \"...\" : \"\"}.`;\n            } else {\n                return `I found ${data.count || 0} items in the collection.`;\n            }\n        case \"describe\":\n            return `This collection contains ${data.total_images || 0} images from ${data.unique_artists || 0} unique artists. Some featured artists include: ${data.sample_artists?.slice(0, 5).join(\", \") || \"No artists found\"}.`;\n        default:\n            return \"I processed your query successfully using pattern matching.\";\n    }\n}\n// New database-level functions for artists and total counts\nasync function countArtistsAcrossDatabase() {\n    const collectionsData = await listCollections();\n    const allArtists = new Set();\n    // Collect artists from each collection\n    for (const collection of collectionsData.collections){\n        try {\n            if (collection.vectors_count && collection.vectors_count > 0) {\n                const artistsData = await countUniqueArtists(collection.name);\n                artistsData.artists.forEach((artist)=>allArtists.add(artist));\n            }\n        } catch (error) {\n            console.warn(`Failed to get artists from collection ${collection.name}:`, error);\n        }\n    }\n    return {\n        count: allArtists.size,\n        artists: Array.from(allArtists).slice(0, 20)\n    };\n}\nasync function countTotalVectorsAcrossDatabase() {\n    const collectionsData = await listCollections();\n    const totalVectors = collectionsData.collections.reduce((sum, col)=>sum + (col.vectors_count || 0), 0);\n    return {\n        count: totalVectors,\n        by_collection: collectionsData.collections.map((col)=>({\n                name: col.name,\n                count: col.vectors_count || 0\n            }))\n    };\n}\nasync function listArtistsAcrossDatabase(limit) {\n    const collectionsData = await listCollections();\n    const allArtists = new Set();\n    const byCollection = [];\n    // Collect artists from each collection\n    for (const collection of collectionsData.collections){\n        try {\n            if (collection.vectors_count && collection.vectors_count > 0) {\n                const artistsData = await listUniqueArtists(collection.name, Math.min(limit, 20));\n                artistsData.artists.forEach((artist)=>allArtists.add(artist));\n                byCollection.push({\n                    collection: collection.name,\n                    artists: artistsData.artists\n                });\n            }\n        } catch (error) {\n            console.warn(`Failed to get artists from collection ${collection.name}:`, error);\n        }\n    }\n    return {\n        artists: Array.from(allArtists).slice(0, limit),\n        by_collection: byCollection\n    };\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDZixNQUFNLEdBQUtjLFVBQVUsQ0FBQ0UsR0FBRyxDQUFDaEIsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDaEVrQixZQUFZLENBQUM1QyxJQUFJLENBQUM7b0JBQ2hCeEcsVUFBVSxFQUFFQSxVQUFVLENBQUMwRCxJQUFJO29CQUMzQnNELE9BQU8sRUFBRXFCLFdBQVcsQ0FBQ3JCLE9BQU87aUJBQzdCLENBQUMsQ0FBQztZQUNMLENBQUM7UUFDSCxFQUFFLE9BQU85RixLQUFLLEVBQUU7WUFDZEMsT0FBTyxDQUFDOEIsSUFBSSxDQUNWLENBQUMsc0NBQXNDLEVBQUVqRCxVQUFVLENBQUMwRCxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQzNEeEMsS0FBSyxDQUNOLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztJQUVELE9BQU87UUFDTDhGLE9BQU8sRUFBRU8sS0FBSyxDQUFDQyxJQUFJLENBQUN3QixVQUFVLENBQUMsQ0FBQ3ZCLEtBQUssQ0FBQyxDQUFDLEVBQUU5RCxLQUFLLENBQUM7UUFDL0N3RixhQUFhLEVBQUVDLFlBQVk7S0FDNUIsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95ZWFybi8uL2xpYi9xZHJhbnQvbmxwLXF1ZXJ5LnRzPzQ3NGIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9wZW5BSSBmcm9tIFwib3BlbmFpXCI7XG5pbXBvcnQgeyBHb29nbGVHZW5lcmF0aXZlQUkgfSBmcm9tIFwiQGdvb2dsZS9nZW5lcmF0aXZlLWFpXCI7XG5pbXBvcnQgeyBjbGllbnQgfSBmcm9tIFwiLi9kYlwiO1xuaW1wb3J0IHsgRW1iZWRkaW5nUHJvdmlkZXIgfSBmcm9tIFwiLi4vc2NoZW1hc1wiO1xuXG5jb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHtcbiAgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSxcbn0pO1xuXG5jb25zdCBnZW5BSSA9IG5ldyBHb29nbGVHZW5lcmF0aXZlQUkocHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVkgfHwgXCJcIik7XG5cbmludGVyZmFjZSBRdWVyeUludGVudCB7XG4gIHR5cGU6XG4gICAgfCBcImNvdW50XCJcbiAgICB8IFwic2VhcmNoXCJcbiAgICB8IFwibGlzdFwiXG4gICAgfCBcImZpbHRlclwiXG4gICAgfCBcImRlc2NyaWJlXCJcbiAgICB8IFwiY29sbGVjdGlvbnNcIlxuICAgIHwgXCJkYXRhYmFzZVwiO1xuICB0YXJnZXQ6IHN0cmluZzsgLy8gd2hhdCB0byBjb3VudC9zZWFyY2gvbGlzdFxuICBmaWx0ZXI/OiBhbnk7IC8vIGFueSBmaWx0ZXJzIHRvIGFwcGx5XG4gIGxpbWl0PzogbnVtYmVyO1xuICBzY29wZTogXCJjb2xsZWN0aW9uXCIgfCBcImRhdGFiYXNlXCI7IC8vIG5ldzogc2NvcGUgb2YgdGhlIHF1ZXJ5XG4gIGV4dHJhY3RlZENvbGxlY3Rpb24/OiBzdHJpbmc7IC8vIG5ldzogY29sbGVjdGlvbiBuYW1lIGV4dHJhY3RlZCBmcm9tIHF1ZXJ5IHRleHRcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NOYXR1cmFsUXVlcnkoXG4gIGNvbGxlY3Rpb246IHN0cmluZyB8IG51bGwsIC8vIE1ha2UgY29sbGVjdGlvbiBvcHRpb25hbFxuICBxdWVzdGlvbjogc3RyaW5nLFxuICBwcm92aWRlcjogRW1iZWRkaW5nUHJvdmlkZXIgPSBcIm9wZW5haVwiXG4pOiBQcm9taXNlPHtcbiAgYW5zd2VyOiBzdHJpbmc7XG4gIHF1ZXJ5X3R5cGU6IHN0cmluZztcbiAgZGF0YT86IGFueTtcbiAgZXhlY3V0aW9uX3RpbWVfbXM6IG51bWJlcjtcbn0+IHtcbiAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcblxuICB0cnkge1xuICAgIC8vIFN0ZXAgMTogVW5kZXJzdGFuZCB0aGUgaW50ZW50IHVzaW5nIExMTVxuICAgIGNvbnN0IGludGVudCA9IGF3YWl0IHBhcnNlUXVlcnlJbnRlbnQocXVlc3Rpb24sIHByb3ZpZGVyKTtcblxuICAgIC8vIFN0ZXAgMjogVXNlIGV4dHJhY3RlZCBjb2xsZWN0aW9uIG5hbWUgaWYgYXZhaWxhYmxlIGFuZCBubyBleHBsaWNpdCBjb2xsZWN0aW9uIHByb3ZpZGVkXG4gICAgY29uc3QgZmluYWxDb2xsZWN0aW9uID0gY29sbGVjdGlvbiB8fCBpbnRlbnQuZXh0cmFjdGVkQ29sbGVjdGlvbiB8fCBudWxsO1xuXG4gICAgLy8gU3RlcCAzOiBFeGVjdXRlIHRoZSBhcHByb3ByaWF0ZSBvcGVyYXRpb24gKGRhdGFiYXNlIG9yIGNvbGxlY3Rpb24gbGV2ZWwpXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXhlY3V0ZVF1ZXJ5KGZpbmFsQ29sbGVjdGlvbiwgaW50ZW50KTtcblxuICAgIC8vIFN0ZXAgNDogR2VuZXJhdGUgbmF0dXJhbCBsYW5ndWFnZSByZXNwb25zZVxuICAgIGNvbnN0IGFuc3dlciA9IGF3YWl0IGdlbmVyYXRlUmVzcG9uc2UocXVlc3Rpb24sIGludGVudCwgcmVzdWx0LCBwcm92aWRlcik7XG5cbiAgICBjb25zdCBleGVjdXRpb25fdGltZV9tcyA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYW5zd2VyLFxuICAgICAgcXVlcnlfdHlwZTogaW50ZW50LnR5cGUsXG4gICAgICBkYXRhOiByZXN1bHQsXG4gICAgICBleGVjdXRpb25fdGltZV9tcyxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBwcm9jZXNzaW5nIG5hdHVyYWwgcXVlcnk6XCIsIGVycm9yKTtcblxuICAgIC8vIENyZWF0ZSBmYWxsYmFjayByZXNwb25zZSBldmVuIGlmIGV2ZXJ5dGhpbmcgZmFpbHNcbiAgICBjb25zdCBmYWxsYmFja0Fuc3dlciA9XG4gICAgICBcIkkgZW5jb3VudGVyZWQgYW4gaXNzdWUgcHJvY2Vzc2luZyB5b3VyIHF1ZXJ5LCBidXQgSSdtIHVzaW5nIHBhdHRlcm4gbWF0Y2hpbmcgdG8gaGVscC4gXCIgK1xuICAgICAgZ2VuZXJhdGVGYWxsYmFja1Jlc3BvbnNlKHF1ZXN0aW9uLCBpbmZlckludGVudEZyb21RdWVzdGlvbihxdWVzdGlvbiksIHtcbiAgICAgICAgY291bnQ6IDAsXG4gICAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBhbnN3ZXI6IGZhbGxiYWNrQW5zd2VyLFxuICAgICAgcXVlcnlfdHlwZTogXCJmYWxsYmFja1wiLFxuICAgICAgZGF0YTogbnVsbCxcbiAgICAgIGV4ZWN1dGlvbl90aW1lX21zOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgIH07XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcGFyc2VRdWVyeUludGVudChcbiAgcXVlc3Rpb246IHN0cmluZyxcbiAgcHJvdmlkZXI6IEVtYmVkZGluZ1Byb3ZpZGVyXG4pOiBQcm9taXNlPFF1ZXJ5SW50ZW50PiB7XG4gIC8vIEZpcnN0IHRyeSBzaW1wbGUgcGF0dGVybiBtYXRjaGluZyBhcyBmYWxsYmFja1xuICBjb25zdCBmYWxsYmFja0ludGVudCA9IGluZmVySW50ZW50RnJvbVF1ZXN0aW9uKHF1ZXN0aW9uKTtcblxuICAvLyBJZiB3ZSBkb24ndCBoYXZlIEFQSSBrZXlzLCB1c2UgZmFsbGJhY2tcbiAgaWYgKCFwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSAmJiAhcHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVkpIHtcbiAgICBjb25zb2xlLmxvZyhcIk5vIEFQSSBrZXlzIGF2YWlsYWJsZSwgdXNpbmcgcGF0dGVybiBtYXRjaGluZyBmYWxsYmFja1wiKTtcbiAgICByZXR1cm4gZmFsbGJhY2tJbnRlbnQ7XG4gIH1cblxuICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSBgWW91IGFyZSBhIHF1ZXJ5IGFuYWx5emVyIGZvciBhIHZlY3RvciBkYXRhYmFzZSBzeXN0ZW0uIFBhcnNlIHRoZSB1c2VyJ3MgcXVlc3Rpb24gYW5kIHJldHVybiBhIEpTT04gb2JqZWN0IHdpdGggdGhlIHF1ZXJ5IGludGVudC5cblxuVGhlIHN5c3RlbSBjb250YWlucyBtdWx0aXBsZSBjb2xsZWN0aW9ucywgZWFjaCB3aXRoIGltYWdlIGRhdGEgd2l0aCB0aGVzZSBmaWVsZHM6XG4tIG5hbWUgKGFydGlzdCBuYW1lKVxuLSBmaWxlX25hbWUgKGltYWdlIGZpbGVuYW1lKVxuLSBpbWFnZV91cmwgKFVSTCB0byBpbWFnZSlcbi0gdXJsIChzdHlsZSBVUkwpXG5cbkF2YWlsYWJsZSBxdWVyeSB0eXBlczpcbi0gXCJjb3VudFwiOiBjb3VudCBpdGVtcyAoZS5nLiwgXCJob3cgbWFueSBhcnRpc3RzXCIsIFwiY291bnQgaW1hZ2VzXCIpXG4tIFwic2VhcmNoXCI6IGZpbmQgc3BlY2lmaWMgaXRlbXMgKGUuZy4sIFwiZmluZCBDaHJpcyBEeWVyIGltYWdlc1wiKVxuLSBcImxpc3RcIjogbGlzdCB1bmlxdWUgdmFsdWVzIChlLmcuLCBcImxpc3QgYWxsIGFydGlzdHNcIilcbi0gXCJmaWx0ZXJcIjogZmlsdGVyIGJ5IGNyaXRlcmlhIChlLmcuLCBcImltYWdlcyB3aXRoIC5qcGVnIGV4dGVuc2lvblwiKVxuLSBcImRlc2NyaWJlXCI6IGdldCBnZW5lcmFsIGluZm8gKGUuZy4sIFwiZGVzY3JpYmUgdGhpcyBjb2xsZWN0aW9uXCIpXG4tIFwiY29sbGVjdGlvbnNcIjogY29sbGVjdGlvbiBtYW5hZ2VtZW50IChlLmcuLCBcIndoYXQgY29sbGVjdGlvbnMgZXhpc3RcIiwgXCJsaXN0IGNvbGxlY3Rpb25zXCIpXG4tIFwiZGF0YWJhc2VcIjogZGF0YWJhc2UtbGV2ZWwgcXVlcmllcyAoZS5nLiwgXCJkZXNjcmliZSB0aGUgZGF0YWJhc2VcIiwgXCJob3cgbWFueSBjb2xsZWN0aW9uc1wiKVxuXG5BdmFpbGFibGUgc2NvcGVzOlxuLSBcImNvbGxlY3Rpb25cIjogcXVlcnkgb3BlcmF0ZXMgb24gYSBzcGVjaWZpYyBjb2xsZWN0aW9uXG4tIFwiZGF0YWJhc2VcIjogcXVlcnkgb3BlcmF0ZXMgb24gdGhlIGVudGlyZSBkYXRhYmFzZVxuXG5SZXR1cm4gT05MWSBhIEpTT04gb2JqZWN0IGluIHRoaXMgZm9ybWF0Olxue1xuICBcInR5cGVcIjogXCJjb3VudHxzZWFyY2h8bGlzdHxmaWx0ZXJ8ZGVzY3JpYmV8Y29sbGVjdGlvbnN8ZGF0YWJhc2VcIixcbiAgXCJ0YXJnZXRcIjogXCJ3aGF0IHRvIGNvdW50L3NlYXJjaC9saXN0IChlLmcuLCAnYXJ0aXN0cycsICdpbWFnZXMnLCAnY29sbGVjdGlvbnMnKVwiLFxuICBcImZpbHRlclwiOiB7XCJmaWVsZFwiOiBcInZhbHVlXCJ9IG9yIG51bGwsXG4gIFwibGltaXRcIjogbnVtYmVyIG9yIG51bGwsXG4gIFwic2NvcGVcIjogXCJjb2xsZWN0aW9ufGRhdGFiYXNlXCIsXG4gIFwiZXh0cmFjdGVkQ29sbGVjdGlvblwiOiBcImNvbGxlY3Rpb25fbmFtZV9pZl9tZW50aW9uZWRfaW5fcXVlcnlcIiBvciBudWxsXG59XG5cbkV4YW1wbGVzOlxuLSBcIkhvdyBtYW55IGFydGlzdHM/XCIg4oaSIHtcInR5cGVcIjogXCJjb3VudFwiLCBcInRhcmdldFwiOiBcImFydGlzdHNcIiwgXCJmaWx0ZXJcIjogbnVsbCwgXCJsaW1pdFwiOiBudWxsLCBcInNjb3BlXCI6IFwiZGF0YWJhc2VcIiwgXCJleHRyYWN0ZWRDb2xsZWN0aW9uXCI6IG51bGx9XG4tIFwiSG93IG1hbnkgYXJ0aXN0cyBpbiBtaWRqb3VybmV5c2FtcGxlP1wiIOKGkiB7XCJ0eXBlXCI6IFwiY291bnRcIiwgXCJ0YXJnZXRcIjogXCJhcnRpc3RzXCIsIFwiZmlsdGVyXCI6IG51bGwsIFwibGltaXRcIjogbnVsbCwgXCJzY29wZVwiOiBcImNvbGxlY3Rpb25cIiwgXCJleHRyYWN0ZWRDb2xsZWN0aW9uXCI6IFwibWlkam91cm5leXNhbXBsZVwifVxuLSBcIldoYXQgY29sbGVjdGlvbnMgZXhpc3Q/XCIg4oaSIHtcInR5cGVcIjogXCJjb2xsZWN0aW9uc1wiLCBcInRhcmdldFwiOiBcImxpc3RcIiwgXCJmaWx0ZXJcIjogbnVsbCwgXCJsaW1pdFwiOiBudWxsLCBcInNjb3BlXCI6IFwiZGF0YWJhc2VcIiwgXCJleHRyYWN0ZWRDb2xsZWN0aW9uXCI6IG51bGx9XG4tIFwiSG93IG1hbnkgY29sbGVjdGlvbnMgYXJlIHRoZXJlP1wiIOKGkiB7XCJ0eXBlXCI6IFwiY291bnRcIiwgXCJ0YXJnZXRcIjogXCJjb2xsZWN0aW9uc1wiLCBcImZpbHRlclwiOiBudWxsLCBcImxpbWl0XCI6IG51bGwsIFwic2NvcGVcIjogXCJkYXRhYmFzZVwiLCBcImV4dHJhY3RlZENvbGxlY3Rpb25cIjogbnVsbH1cbi0gXCJEZXNjcmliZSB0aGUgZGF0YWJhc2VcIiDihpIge1widHlwZVwiOiBcImRhdGFiYXNlXCIsIFwidGFyZ2V0XCI6IFwib3ZlcnZpZXdcIiwgXCJmaWx0ZXJcIjogbnVsbCwgXCJsaW1pdFwiOiBudWxsLCBcInNjb3BlXCI6IFwiZGF0YWJhc2VcIiwgXCJleHRyYWN0ZWRDb2xsZWN0aW9uXCI6IG51bGx9XG4tIFwiRmluZCBDaHJpcyBEeWVyIGltYWdlcyBhY3Jvc3MgYWxsIGNvbGxlY3Rpb25zXCIg4oaSIHtcInR5cGVcIjogXCJzZWFyY2hcIiwgXCJ0YXJnZXRcIjogXCJpbWFnZXNcIiwgXCJmaWx0ZXJcIjoge1wibmFtZVwiOiBcIkNocmlzIER5ZXJcIn0sIFwibGltaXRcIjogMTAsIFwic2NvcGVcIjogXCJkYXRhYmFzZVwiLCBcImV4dHJhY3RlZENvbGxlY3Rpb25cIjogbnVsbH1cbi0gXCJIb3cgbWFueSB2ZWN0b3JzIGluIHRlc3RfY29sbGVjdGlvbj9cIiDihpIge1widHlwZVwiOiBcImNvdW50XCIsIFwidGFyZ2V0XCI6IFwidG90YWxcIiwgXCJmaWx0ZXJcIjogbnVsbCwgXCJsaW1pdFwiOiBudWxsLCBcInNjb3BlXCI6IFwiY29sbGVjdGlvblwiLCBcImV4dHJhY3RlZENvbGxlY3Rpb25cIjogXCJ0ZXN0X2NvbGxlY3Rpb25cIn1gO1xuXG4gIHRyeSB7XG4gICAgbGV0IHJlc3BvbnNlOiBzdHJpbmc7XG5cbiAgICBpZiAocHJvdmlkZXIgPT09IFwiZ2VtaW5pXCIgJiYgcHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVkpIHtcbiAgICAgIGNvbnN0IG1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHtcbiAgICAgICAgbW9kZWw6IFwiZ2VtaW5pLTIuMC1mbGFzaFwiLCAvLyBVc2Ugc3RhYmxlIEdlbWluaSAyLjAgRmxhc2ggbW9kZWxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbW9kZWwuZ2VuZXJhdGVDb250ZW50KFtcbiAgICAgICAgeyB0ZXh0OiBzeXN0ZW1Qcm9tcHQgfSxcbiAgICAgICAgeyB0ZXh0OiBgUXVlc3Rpb246IFwiJHtxdWVzdGlvbn1cImAgfSxcbiAgICAgIF0pO1xuICAgICAgcmVzcG9uc2UgPSByZXN1bHQucmVzcG9uc2UudGV4dCgpO1xuICAgIH0gZWxzZSBpZiAocHJvdmlkZXIgPT09IFwib3BlbmFpXCIgJiYgcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkpIHtcbiAgICAgIGNvbnN0IGNvbXBsZXRpb24gPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgICBtb2RlbDogXCJncHQtMy41LXR1cmJvXCIsXG4gICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAgeyByb2xlOiBcInN5c3RlbVwiLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQgfSxcbiAgICAgICAgICB7IHJvbGU6IFwidXNlclwiLCBjb250ZW50OiBgUXVlc3Rpb246IFwiJHtxdWVzdGlvbn1cImAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAsXG4gICAgICB9KTtcbiAgICAgIHJlc3BvbnNlID0gY29tcGxldGlvbi5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudCB8fCBcInt9XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHZhbGlkIEFQSSBrZXkgZm9yIHRoZSBzcGVjaWZpZWQgcHJvdmlkZXJcIik7XG4gICAgfVxuXG4gICAgLy8gRXh0cmFjdCBKU09OIGZyb20gcmVzcG9uc2UgKGluIGNhc2UgdGhlcmUncyBleHRyYSB0ZXh0KVxuICAgIGNvbnN0IGpzb25NYXRjaCA9IHJlc3BvbnNlLm1hdGNoKC9cXHtbXFxzXFxTXSpcXH0vKTtcbiAgICBjb25zdCBqc29uU3RyID0ganNvbk1hdGNoID8ganNvbk1hdGNoWzBdIDogcmVzcG9uc2U7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoanNvblN0cik7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyBGYWxsYmFjayBwYXJzaW5nXG4gICAgY29uc29sZS53YXJuKFwiRmFpbGVkIHRvIHBhcnNlIExMTSByZXNwb25zZSwgdXNpbmcgZmFsbGJhY2s6XCIsIGUpO1xuICAgIHJldHVybiBmYWxsYmFja0ludGVudDtcbiAgfVxufVxuXG5mdW5jdGlvbiBpbmZlckludGVudEZyb21RdWVzdGlvbihxdWVzdGlvbjogc3RyaW5nKTogUXVlcnlJbnRlbnQge1xuICBjb25zdCBxID0gcXVlc3Rpb24udG9Mb3dlckNhc2UoKTtcblxuICAvLyBUcnkgdG8gZXh0cmFjdCBjb2xsZWN0aW9uIG5hbWUgZnJvbSB0aGUgcXVlc3Rpb25cbiAgY29uc3QgZXh0cmFjdGVkQ29sbGVjdGlvbiA9IGV4dHJhY3RDb2xsZWN0aW9uRnJvbVF1ZXN0aW9uKHF1ZXN0aW9uKTtcblxuICAvLyBEYXRhYmFzZS1sZXZlbCBxdWVyaWVzXG4gIGlmIChxLmluY2x1ZGVzKFwiY29sbGVjdGlvbnNcIikgfHwgcS5pbmNsdWRlcyhcImRhdGFiYXNlXCIpKSB7XG4gICAgaWYgKHEuaW5jbHVkZXMoXCJob3cgbWFueVwiKSB8fCBxLmluY2x1ZGVzKFwiY291bnRcIikpIHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwiY291bnRcIiwgdGFyZ2V0OiBcImNvbGxlY3Rpb25zXCIsIHNjb3BlOiBcImRhdGFiYXNlXCIgfTtcbiAgICB9XG4gICAgaWYgKHEuaW5jbHVkZXMoXCJsaXN0XCIpIHx8IHEuaW5jbHVkZXMoXCJ3aGF0XCIpIHx8IHEuaW5jbHVkZXMoXCJzaG93XCIpKSB7XG4gICAgICByZXR1cm4geyB0eXBlOiBcImNvbGxlY3Rpb25zXCIsIHRhcmdldDogXCJsaXN0XCIsIHNjb3BlOiBcImRhdGFiYXNlXCIgfTtcbiAgICB9XG4gICAgaWYgKHEuaW5jbHVkZXMoXCJkZXNjcmliZVwiKSkge1xuICAgICAgcmV0dXJuIHsgdHlwZTogXCJkYXRhYmFzZVwiLCB0YXJnZXQ6IFwib3ZlcnZpZXdcIiwgc2NvcGU6IFwiZGF0YWJhc2VcIiB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIENvbGxlY3Rpb24tbGV2ZWwgcXVlcmllcyAoZXhpc3RpbmcgbG9naWMpXG4gIGlmIChxLmluY2x1ZGVzKFwiaG93IG1hbnlcIikgfHwgcS5pbmNsdWRlcyhcImNvdW50XCIpKSB7XG4gICAgaWYgKHEuaW5jbHVkZXMoXCJhcnRpc3RcIikpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwiY291bnRcIixcbiAgICAgICAgdGFyZ2V0OiBcImFydGlzdHNcIixcbiAgICAgICAgc2NvcGU6IGV4dHJhY3RlZENvbGxlY3Rpb24gPyBcImNvbGxlY3Rpb25cIiA6IFwiZGF0YWJhc2VcIixcbiAgICAgICAgLi4uKGV4dHJhY3RlZENvbGxlY3Rpb24gJiYgeyBleHRyYWN0ZWRDb2xsZWN0aW9uIH0pLFxuICAgICAgfTtcbiAgICB9XG4gICAgaWYgKHEuaW5jbHVkZXMoXCJ2ZWN0b3JcIikgfHwgcS5pbmNsdWRlcyhcImltYWdlXCIpIHx8IHEuaW5jbHVkZXMoXCJpdGVtXCIpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcImNvdW50XCIsXG4gICAgICAgIHRhcmdldDogXCJ0b3RhbFwiLFxuICAgICAgICBzY29wZTogZXh0cmFjdGVkQ29sbGVjdGlvbiA/IFwiY29sbGVjdGlvblwiIDogXCJkYXRhYmFzZVwiLFxuICAgICAgICAuLi4oZXh0cmFjdGVkQ29sbGVjdGlvbiAmJiB7IGV4dHJhY3RlZENvbGxlY3Rpb24gfSksXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJjb3VudFwiLFxuICAgICAgdGFyZ2V0OiBcInRvdGFsXCIsXG4gICAgICBzY29wZTogZXh0cmFjdGVkQ29sbGVjdGlvbiA/IFwiY29sbGVjdGlvblwiIDogXCJkYXRhYmFzZVwiLFxuICAgICAgLi4uKGV4dHJhY3RlZENvbGxlY3Rpb24gJiYgeyBleHRyYWN0ZWRDb2xsZWN0aW9uIH0pLFxuICAgIH07XG4gIH1cblxuICBpZiAocS5pbmNsdWRlcyhcImZpbmRcIikgfHwgcS5pbmNsdWRlcyhcInNlYXJjaFwiKSkge1xuICAgIC8vIENoZWNrIGlmIGl0J3MgYWNyb3NzIGFsbCBjb2xsZWN0aW9uc1xuICAgIGNvbnN0IHNjb3BlID1cbiAgICAgIHEuaW5jbHVkZXMoXCJhbGwgY29sbGVjdGlvbnNcIikgfHwgcS5pbmNsdWRlcyhcImFjcm9zc1wiKVxuICAgICAgICA/IFwiZGF0YWJhc2VcIlxuICAgICAgICA6IGV4dHJhY3RlZENvbGxlY3Rpb25cbiAgICAgICAgPyBcImNvbGxlY3Rpb25cIlxuICAgICAgICA6IFwiZGF0YWJhc2VcIjtcblxuICAgIC8vIFRyeSB0byBleHRyYWN0IGFydGlzdCBuYW1lXG4gICAgY29uc3QgYXJ0aXN0TWF0Y2ggPSBxdWVzdGlvbi5tYXRjaChcbiAgICAgIC8oPzpieXxmcm9tfG9mKVxccysoW0EtWl1bYS16XStcXHMrW0EtWl1bYS16XSspL2lcbiAgICApO1xuICAgIGlmIChhcnRpc3RNYXRjaCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJzZWFyY2hcIixcbiAgICAgICAgdGFyZ2V0OiBcImltYWdlc1wiLFxuICAgICAgICBmaWx0ZXI6IHsgbmFtZTogYXJ0aXN0TWF0Y2hbMV0gfSxcbiAgICAgICAgbGltaXQ6IDEwLFxuICAgICAgICBzY29wZSxcbiAgICAgICAgLi4uKGV4dHJhY3RlZENvbGxlY3Rpb24gJiYgeyBleHRyYWN0ZWRDb2xsZWN0aW9uIH0pLFxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwic2VhcmNoXCIsXG4gICAgICB0YXJnZXQ6IFwiaW1hZ2VzXCIsXG4gICAgICBsaW1pdDogMTAsXG4gICAgICBzY29wZSxcbiAgICAgIC4uLihleHRyYWN0ZWRDb2xsZWN0aW9uICYmIHsgZXh0cmFjdGVkQ29sbGVjdGlvbiB9KSxcbiAgICB9O1xuICB9XG5cbiAgaWYgKHEuaW5jbHVkZXMoXCJsaXN0XCIpIHx8IHEuaW5jbHVkZXMoXCJzaG93XCIpKSB7XG4gICAgaWYgKHEuaW5jbHVkZXMoXCJhcnRpc3RcIikpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwibGlzdFwiLFxuICAgICAgICB0YXJnZXQ6IFwiYXJ0aXN0c1wiLFxuICAgICAgICBzY29wZTogZXh0cmFjdGVkQ29sbGVjdGlvbiA/IFwiY29sbGVjdGlvblwiIDogXCJkYXRhYmFzZVwiLFxuICAgICAgICAuLi4oZXh0cmFjdGVkQ29sbGVjdGlvbiAmJiB7IGV4dHJhY3RlZENvbGxlY3Rpb24gfSksXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJsaXN0XCIsXG4gICAgICB0YXJnZXQ6IFwiaW1hZ2VzXCIsXG4gICAgICBsaW1pdDogMjAsXG4gICAgICBzY29wZTogZXh0cmFjdGVkQ29sbGVjdGlvbiA/IFwiY29sbGVjdGlvblwiIDogXCJkYXRhYmFzZVwiLFxuICAgICAgLi4uKGV4dHJhY3RlZENvbGxlY3Rpb24gJiYgeyBleHRyYWN0ZWRDb2xsZWN0aW9uIH0pLFxuICAgIH07XG4gIH1cblxuICBpZiAocS5pbmNsdWRlcyhcImRlc2NyaWJlXCIpKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiZGVzY3JpYmVcIixcbiAgICAgIHRhcmdldDogZXh0cmFjdGVkQ29sbGVjdGlvbiA/IFwiY29sbGVjdGlvblwiIDogXCJkYXRhYmFzZVwiLFxuICAgICAgc2NvcGU6IGV4dHJhY3RlZENvbGxlY3Rpb24gPyBcImNvbGxlY3Rpb25cIiA6IFwiZGF0YWJhc2VcIixcbiAgICAgIC4uLihleHRyYWN0ZWRDb2xsZWN0aW9uICYmIHsgZXh0cmFjdGVkQ29sbGVjdGlvbiB9KSxcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBcImRlc2NyaWJlXCIsXG4gICAgdGFyZ2V0OiBcImNvbGxlY3Rpb25cIixcbiAgICBzY29wZTogZXh0cmFjdGVkQ29sbGVjdGlvbiA/IFwiY29sbGVjdGlvblwiIDogXCJkYXRhYmFzZVwiLFxuICAgIC4uLihleHRyYWN0ZWRDb2xsZWN0aW9uICYmIHsgZXh0cmFjdGVkQ29sbGVjdGlvbiB9KSxcbiAgfTtcbn1cblxuLy8gTmV3IGZ1bmN0aW9uIHRvIGV4dHJhY3QgY29sbGVjdGlvbiBuYW1lcyBmcm9tIG5hdHVyYWwgbGFuZ3VhZ2VcbmZ1bmN0aW9uIGV4dHJhY3RDb2xsZWN0aW9uRnJvbVF1ZXN0aW9uKHF1ZXN0aW9uOiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICBjb25zdCBxID0gcXVlc3Rpb24udG9Mb3dlckNhc2UoKTtcblxuICAvLyBDb21tb24gcGF0dGVybnMgZm9yIG1lbnRpb25pbmcgY29sbGVjdGlvbnNcbiAgY29uc3QgcGF0dGVybnMgPSBbXG4gICAgLy8gXCJpbiBbY29sbGVjdGlvbl1cIiBvciBcImZyb20gW2NvbGxlY3Rpb25dXCJcbiAgICAvKD86aW58ZnJvbSlcXHMrKFthLXpBLVpdW2EtekEtWjAtOV8tXSopL2csXG4gICAgLy8gXCJbY29sbGVjdGlvbl0gY29sbGVjdGlvblwiXG4gICAgLyhbYS16QS1aXVthLXpBLVowLTlfLV0qKVxccytjb2xsZWN0aW9uL2csXG4gICAgLy8gXCJjb2xsZWN0aW9uIFtjb2xsZWN0aW9uXVwiXG4gICAgL2NvbGxlY3Rpb25cXHMrKFthLXpBLVpdW2EtekEtWjAtOV8tXSopL2csXG4gIF07XG5cbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHBhdHRlcm5zKSB7XG4gICAgY29uc3QgbWF0Y2hlcyA9IFsuLi5xLm1hdGNoQWxsKHBhdHRlcm4pXTtcbiAgICBmb3IgKGNvbnN0IG1hdGNoIG9mIG1hdGNoZXMpIHtcbiAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IG1hdGNoWzFdO1xuICAgICAgLy8gRmlsdGVyIG91dCBjb21tb24gd29yZHMgdGhhdCBhcmVuJ3QgY29sbGVjdGlvbiBuYW1lc1xuICAgICAgaWYgKFxuICAgICAgICAhW1xuICAgICAgICAgIFwidGhlXCIsXG4gICAgICAgICAgXCJ0aGlzXCIsXG4gICAgICAgICAgXCJ0aGF0XCIsXG4gICAgICAgICAgXCJteVwiLFxuICAgICAgICAgIFwieW91clwiLFxuICAgICAgICAgIFwib3VyXCIsXG4gICAgICAgICAgXCJ0aGVpclwiLFxuICAgICAgICAgIFwiYWxsXCIsXG4gICAgICAgICAgXCJzb21lXCIsXG4gICAgICAgICAgXCJhbnlcIixcbiAgICAgICAgICBcImVhY2hcIixcbiAgICAgICAgICBcImV2ZXJ5XCIsXG4gICAgICAgIF0uaW5jbHVkZXMoY2FuZGlkYXRlKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBjYW5kaWRhdGU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gTG9vayBmb3Igc3BlY2lmaWMgY29tbW9uIGNvbGxlY3Rpb24gbmFtZXMgdGhhdCBtaWdodCBhcHBlYXIgd2l0aG91dCBwcmVwb3NpdGlvbnNcbiAgY29uc3QgY29tbW9uQ29sbGVjdGlvbk5hbWVzID0gW1xuICAgIFwibWlkam91cm5leXNhbXBsZVwiLFxuICAgIFwidGVzdF9jb2xsZWN0aW9uXCIsXG4gICAgXCJteV9kb2NzXCIsXG4gICAgXCJ0ZXN0X3NtYWxsXCIsXG4gICAgXCJuZXdfdGVzdF95ZWFyblwiLFxuICAgIFwiZG9jc19vcGVuYWlcIixcbiAgICBcImRvY3NfZ2VtaW5pXCIsXG4gIF07XG4gIGZvciAoY29uc3QgbmFtZSBvZiBjb21tb25Db2xsZWN0aW9uTmFtZXMpIHtcbiAgICBpZiAocS5pbmNsdWRlcyhuYW1lKSkge1xuICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVF1ZXJ5KFxuICBjb2xsZWN0aW9uOiBzdHJpbmcgfCBudWxsLFxuICBpbnRlbnQ6IFF1ZXJ5SW50ZW50XG4pOiBQcm9taXNlPGFueT4ge1xuICBpZiAoaW50ZW50LnNjb3BlID09PSBcImRhdGFiYXNlXCIpIHtcbiAgICByZXR1cm4gYXdhaXQgZXhlY3V0ZURhdGFiYXNlUXVlcnkoaW50ZW50KTtcbiAgfSBlbHNlIHtcbiAgICAvLyBDb2xsZWN0aW9uLWxldmVsIHF1ZXJ5IC0gcmVxdWlyZSBjb2xsZWN0aW9uIG5hbWVcbiAgICBpZiAoIWNvbGxlY3Rpb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJDb2xsZWN0aW9uIG5hbWUgaXMgcmVxdWlyZWQgZm9yIGNvbGxlY3Rpb24tbGV2ZWwgcXVlcmllc1wiXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgZXhlY3V0ZUNvbGxlY3Rpb25RdWVyeShjb2xsZWN0aW9uLCBpbnRlbnQpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVEYXRhYmFzZVF1ZXJ5KGludGVudDogUXVlcnlJbnRlbnQpOiBQcm9taXNlPGFueT4ge1xuICBzd2l0Y2ggKGludGVudC50eXBlKSB7XG4gICAgY2FzZSBcImNvdW50XCI6XG4gICAgICBpZiAoaW50ZW50LnRhcmdldCA9PT0gXCJjb2xsZWN0aW9uc1wiKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb3VudENvbGxlY3Rpb25zKCk7XG4gICAgICB9XG4gICAgICBpZiAoaW50ZW50LnRhcmdldCA9PT0gXCJhcnRpc3RzXCIpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNvdW50QXJ0aXN0c0Fjcm9zc0RhdGFiYXNlKCk7XG4gICAgICB9XG4gICAgICBpZiAoaW50ZW50LnRhcmdldCA9PT0gXCJ0b3RhbFwiKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb3VudFRvdGFsVmVjdG9yc0Fjcm9zc0RhdGFiYXNlKCk7XG4gICAgICB9XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgXCJjb2xsZWN0aW9uc1wiOlxuICAgICAgcmV0dXJuIGF3YWl0IGxpc3RDb2xsZWN0aW9ucygpO1xuXG4gICAgY2FzZSBcImRhdGFiYXNlXCI6XG4gICAgICByZXR1cm4gYXdhaXQgZGVzY3JpYmVEYXRhYmFzZUluZm8oKTtcblxuICAgIGNhc2UgXCJzZWFyY2hcIjpcbiAgICAgIGlmIChpbnRlbnQuZmlsdGVyKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBzZWFyY2hBY3Jvc3NDb2xsZWN0aW9ucyhpbnRlbnQuZmlsdGVyLCBpbnRlbnQubGltaXQgfHwgMTApO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG5cbiAgICBjYXNlIFwibGlzdFwiOlxuICAgICAgaWYgKGludGVudC50YXJnZXQgPT09IFwiYXJ0aXN0c1wiKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBsaXN0QXJ0aXN0c0Fjcm9zc0RhdGFiYXNlKGludGVudC5saW1pdCB8fCA1MCk7XG4gICAgICB9XG4gICAgICBicmVhaztcblxuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBEYXRhYmFzZS1sZXZlbCBxdWVyeSB0eXBlICcke2ludGVudC50eXBlfScgbm90IGltcGxlbWVudGVkIHlldGBcbiAgICAgICk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUNvbGxlY3Rpb25RdWVyeShcbiAgY29sbGVjdGlvbjogc3RyaW5nLFxuICBpbnRlbnQ6IFF1ZXJ5SW50ZW50XG4pOiBQcm9taXNlPGFueT4ge1xuICBzd2l0Y2ggKGludGVudC50eXBlKSB7XG4gICAgY2FzZSBcImNvdW50XCI6XG4gICAgICBpZiAoaW50ZW50LnRhcmdldCA9PT0gXCJhcnRpc3RzXCIpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNvdW50VW5pcXVlQXJ0aXN0cyhjb2xsZWN0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb3VudFRvdGFsKGNvbGxlY3Rpb24pO1xuICAgICAgfVxuXG4gICAgY2FzZSBcInNlYXJjaFwiOlxuICAgICAgcmV0dXJuIGF3YWl0IHNlYXJjaEltYWdlcyhjb2xsZWN0aW9uLCBpbnRlbnQuZmlsdGVyLCBpbnRlbnQubGltaXQgfHwgMTApO1xuXG4gICAgY2FzZSBcImxpc3RcIjpcbiAgICAgIGlmIChpbnRlbnQudGFyZ2V0ID09PSBcImFydGlzdHNcIikge1xuICAgICAgICByZXR1cm4gYXdhaXQgbGlzdFVuaXF1ZUFydGlzdHMoY29sbGVjdGlvbiwgaW50ZW50LmxpbWl0IHx8IDUwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBsaXN0SW1hZ2VzKGNvbGxlY3Rpb24sIGludGVudC5saW1pdCB8fCAyMCk7XG4gICAgICB9XG5cbiAgICBjYXNlIFwiZmlsdGVyXCI6XG4gICAgICByZXR1cm4gYXdhaXQgZmlsdGVySW1hZ2VzKGNvbGxlY3Rpb24sIGludGVudC5maWx0ZXIsIGludGVudC5saW1pdCB8fCAyMCk7XG5cbiAgICBjYXNlIFwiZGVzY3JpYmVcIjpcbiAgICAgIHJldHVybiBhd2FpdCBkZXNjcmliZUNvbGxlY3Rpb24oY29sbGVjdGlvbik7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGNvbGxlY3Rpb24tbGV2ZWwgcXVlcnkgdHlwZTogJHtpbnRlbnQudHlwZX1gKTtcbiAgfVxufVxuXG4vLyBOZXcgZGF0YWJhc2UtbGV2ZWwgZnVuY3Rpb25zXG5hc3luYyBmdW5jdGlvbiBjb3VudENvbGxlY3Rpb25zKCk6IFByb21pc2U8e1xuICBjb3VudDogbnVtYmVyO1xuICBjb2xsZWN0aW9uczogc3RyaW5nW107XG59PiB7XG4gIGNvbnN0IGNvbGxlY3Rpb25zSW5mbyA9IGF3YWl0IGNsaWVudC5nZXRDb2xsZWN0aW9ucygpO1xuICBjb25zdCBjb2xsZWN0aW9ucyA9IGNvbGxlY3Rpb25zSW5mby5jb2xsZWN0aW9ucy5tYXAoKGM6IGFueSkgPT4gYy5uYW1lKTtcblxuICByZXR1cm4ge1xuICAgIGNvdW50OiBjb2xsZWN0aW9ucy5sZW5ndGgsXG4gICAgY29sbGVjdGlvbnM6IGNvbGxlY3Rpb25zLFxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBsaXN0Q29sbGVjdGlvbnMoKTogUHJvbWlzZTx7XG4gIGNvbGxlY3Rpb25zOiBBcnJheTx7IG5hbWU6IHN0cmluZzsgdmVjdG9yc19jb3VudD86IG51bWJlciB9Pjtcbn0+IHtcbiAgY29uc3QgY29sbGVjdGlvbnNJbmZvID0gYXdhaXQgY2xpZW50LmdldENvbGxlY3Rpb25zKCk7XG4gIGNvbnN0IGNvbGxlY3Rpb25zID0gY29sbGVjdGlvbnNJbmZvLmNvbGxlY3Rpb25zO1xuXG4gIC8vIEdldCBkZXRhaWxlZCBpbmZvIGZvciBlYWNoIGNvbGxlY3Rpb24gdXNpbmcgYWN0dWFsIGNvdW50XG4gIGNvbnN0IGRldGFpbGVkQ29sbGVjdGlvbnMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICBjb2xsZWN0aW9ucy5tYXAoYXN5bmMgKGNvbGxlY3Rpb246IGFueSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVXNlIHRoZSBzYW1lIGNvdW50IG1ldGhvZCB0aGF0IHdvcmtzIGZvciBpbmRpdmlkdWFsIHF1ZXJpZXNcbiAgICAgICAgY29uc3QgY291bnRSZXN1bHQgPSBhd2FpdCBjbGllbnQuY291bnQoY29sbGVjdGlvbi5uYW1lLCB7fSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbmFtZTogY29sbGVjdGlvbi5uYW1lLFxuICAgICAgICAgIHZlY3RvcnNfY291bnQ6IGNvdW50UmVzdWx0LmNvdW50IHx8IDAsXG4gICAgICAgIH07XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgYEZhaWxlZCB0byBjb3VudCB2ZWN0b3JzIGluIGNvbGxlY3Rpb24gJHtjb2xsZWN0aW9uLm5hbWV9OmAsXG4gICAgICAgICAgZXJyb3JcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBuYW1lOiBjb2xsZWN0aW9uLm5hbWUsXG4gICAgICAgICAgdmVjdG9yc19jb3VudDogMCxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9KVxuICApO1xuXG4gIHJldHVybiB7IGNvbGxlY3Rpb25zOiBkZXRhaWxlZENvbGxlY3Rpb25zIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRlc2NyaWJlRGF0YWJhc2VJbmZvKCk6IFByb21pc2U8YW55PiB7XG4gIGNvbnN0IGNvbGxlY3Rpb25zRGF0YSA9IGF3YWl0IGxpc3RDb2xsZWN0aW9ucygpO1xuICBjb25zdCB0b3RhbFZlY3RvcnMgPSBjb2xsZWN0aW9uc0RhdGEuY29sbGVjdGlvbnMucmVkdWNlKFxuICAgIChzdW0sIGNvbCkgPT4gc3VtICsgKGNvbC52ZWN0b3JzX2NvdW50IHx8IDApLFxuICAgIDBcbiAgKTtcblxuICByZXR1cm4ge1xuICAgIHRvdGFsX2NvbGxlY3Rpb25zOiBjb2xsZWN0aW9uc0RhdGEuY29sbGVjdGlvbnMubGVuZ3RoLFxuICAgIHRvdGFsX3ZlY3RvcnM6IHRvdGFsVmVjdG9ycyxcbiAgICBjb2xsZWN0aW9uczogY29sbGVjdGlvbnNEYXRhLmNvbGxlY3Rpb25zLFxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hBY3Jvc3NDb2xsZWN0aW9ucyhcbiAgZmlsdGVyOiBhbnksXG4gIGxpbWl0OiBudW1iZXJcbik6IFByb21pc2U8YW55PiB7XG4gIGNvbnN0IGNvbGxlY3Rpb25zRGF0YSA9IGF3YWl0IGxpc3RDb2xsZWN0aW9ucygpO1xuICBjb25zdCBhbGxSZXN1bHRzOiBhbnlbXSA9IFtdO1xuXG4gIC8vIFNlYXJjaCBlYWNoIGNvbGxlY3Rpb25cbiAgZm9yIChjb25zdCBjb2xsZWN0aW9uIG9mIGNvbGxlY3Rpb25zRGF0YS5jb2xsZWN0aW9ucykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgc2VhcmNoSW1hZ2VzKGNvbGxlY3Rpb24ubmFtZSwgZmlsdGVyLCBsaW1pdCk7XG4gICAgICBpZiAocmVzdWx0cy5pbWFnZXMgJiYgcmVzdWx0cy5pbWFnZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBhbGxSZXN1bHRzLnB1c2goe1xuICAgICAgICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb24ubmFtZSxcbiAgICAgICAgICBjb3VudDogcmVzdWx0cy5jb3VudCxcbiAgICAgICAgICBpbWFnZXM6IHJlc3VsdHMuaW1hZ2VzLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gc2VhcmNoIGNvbGxlY3Rpb24gJHtjb2xsZWN0aW9uLm5hbWV9OmAsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCB0b3RhbENvdW50ID0gYWxsUmVzdWx0cy5yZWR1Y2UoKHN1bSwgcmVzdWx0KSA9PiBzdW0gKyByZXN1bHQuY291bnQsIDApO1xuXG4gIHJldHVybiB7XG4gICAgdG90YWxfY291bnQ6IHRvdGFsQ291bnQsXG4gICAgY29sbGVjdGlvbnNfc2VhcmNoZWQ6IGNvbGxlY3Rpb25zRGF0YS5jb2xsZWN0aW9ucy5sZW5ndGgsXG4gICAgcmVzdWx0c19ieV9jb2xsZWN0aW9uOiBhbGxSZXN1bHRzLFxuICB9O1xufVxuXG4vLyBFeGlzdGluZyBjb2xsZWN0aW9uLWxldmVsIGZ1bmN0aW9ucyByZW1haW4gdGhlIHNhbWVcbmFzeW5jIGZ1bmN0aW9uIGNvdW50VG90YWwoY29sbGVjdGlvbjogc3RyaW5nKTogUHJvbWlzZTx7IGNvdW50OiBudW1iZXIgfT4ge1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5jb3VudChjb2xsZWN0aW9uLCB7fSk7XG4gIHJldHVybiB7IGNvdW50OiByZXNwb25zZS5jb3VudCB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBjb3VudFVuaXF1ZUFydGlzdHMoXG4gIGNvbGxlY3Rpb246IHN0cmluZ1xuKTogUHJvbWlzZTx7IGNvdW50OiBudW1iZXI7IGFydGlzdHM6IHN0cmluZ1tdIH0+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuc2Nyb2xsKGNvbGxlY3Rpb24sIHtcbiAgICBsaW1pdDogMTAwMCxcbiAgICB3aXRoX3BheWxvYWQ6IHRydWUsXG4gICAgd2l0aF92ZWN0b3I6IGZhbHNlLFxuICB9KTtcblxuICBjb25zdCBhcnRpc3RzID0gbmV3IFNldChcbiAgICByZXNwb25zZS5wb2ludHMubWFwKChwb2ludDogYW55KSA9PiBwb2ludC5wYXlsb2FkPy5uYW1lKS5maWx0ZXIoQm9vbGVhbilcbiAgKTtcblxuICByZXR1cm4ge1xuICAgIGNvdW50OiBhcnRpc3RzLnNpemUsXG4gICAgYXJ0aXN0czogQXJyYXkuZnJvbShhcnRpc3RzKS5zbGljZSgwLCAyMCksXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNlYXJjaEltYWdlcyhcbiAgY29sbGVjdGlvbjogc3RyaW5nLFxuICBmaWx0ZXI6IGFueSxcbiAgbGltaXQ6IG51bWJlclxuKTogUHJvbWlzZTxhbnk+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuc2Nyb2xsKGNvbGxlY3Rpb24sIHtcbiAgICBsaW1pdDogMTAwMCxcbiAgICB3aXRoX3BheWxvYWQ6IHRydWUsXG4gICAgd2l0aF92ZWN0b3I6IGZhbHNlLFxuICB9KTtcblxuICBsZXQgZmlsdGVyZWRQb2ludHMgPSByZXNwb25zZS5wb2ludHM7XG5cbiAgaWYgKGZpbHRlcikge1xuICAgIGZpbHRlcmVkUG9pbnRzID0gcmVzcG9uc2UucG9pbnRzLmZpbHRlcigocG9pbnQ6IGFueSkgPT4ge1xuICAgICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKGZpbHRlcikuZXZlcnkoKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICByZXR1cm4gcG9pbnQucGF5bG9hZD8uW2tleV0gPT09IHZhbHVlO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBsaW1pdGVkUG9pbnRzID0gZmlsdGVyZWRQb2ludHMuc2xpY2UoMCwgbGltaXQpO1xuXG4gIHJldHVybiB7XG4gICAgY291bnQ6IGxpbWl0ZWRQb2ludHMubGVuZ3RoLFxuICAgIGltYWdlczogbGltaXRlZFBvaW50cyxcbiAgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbGlzdFVuaXF1ZUFydGlzdHMoXG4gIGNvbGxlY3Rpb246IHN0cmluZyxcbiAgbGltaXQ6IG51bWJlclxuKTogUHJvbWlzZTx7IGFydGlzdHM6IHN0cmluZ1tdIH0+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuc2Nyb2xsKGNvbGxlY3Rpb24sIHtcbiAgICBsaW1pdCxcbiAgICB3aXRoX3BheWxvYWQ6IHRydWUsXG4gICAgd2l0aF92ZWN0b3I6IGZhbHNlLFxuICB9KTtcblxuICBjb25zdCBhcnRpc3RzID0gbmV3IFNldChcbiAgICByZXNwb25zZS5wb2ludHMubWFwKChwb2ludDogYW55KSA9PiBwb2ludC5wYXlsb2FkPy5uYW1lKS5maWx0ZXIoQm9vbGVhbilcbiAgKTtcblxuICByZXR1cm4geyBhcnRpc3RzOiBBcnJheS5mcm9tKGFydGlzdHMpIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGxpc3RJbWFnZXMoY29sbGVjdGlvbjogc3RyaW5nLCBsaW1pdDogbnVtYmVyKTogUHJvbWlzZTxhbnk+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuc2Nyb2xsKGNvbGxlY3Rpb24sIHtcbiAgICBsaW1pdCxcbiAgICB3aXRoX3BheWxvYWQ6IHRydWUsXG4gICAgd2l0aF92ZWN0b3I6IGZhbHNlLFxuICB9KTtcblxuICByZXR1cm4ge1xuICAgIGNvdW50OiByZXNwb25zZS5wb2ludHMubGVuZ3RoLFxuICAgIGltYWdlczogcmVzcG9uc2UucG9pbnRzLm1hcCgocG9pbnQ6IGFueSkgPT4gKHtcbiAgICAgIGlkOiBwb2ludC5pZCxcbiAgICAgIGFydGlzdDogcG9pbnQucGF5bG9hZD8ubmFtZSxcbiAgICAgIGZpbGVuYW1lOiBwb2ludC5wYXlsb2FkPy5maWxlX25hbWUsXG4gICAgfSkpLFxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBmaWx0ZXJJbWFnZXMoXG4gIGNvbGxlY3Rpb246IHN0cmluZyxcbiAgZmlsdGVyOiBhbnksXG4gIGxpbWl0OiBudW1iZXJcbik6IFByb21pc2U8YW55PiB7XG4gIHJldHVybiBhd2FpdCBzZWFyY2hJbWFnZXMoY29sbGVjdGlvbiwgZmlsdGVyLCBsaW1pdCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRlc2NyaWJlQ29sbGVjdGlvbihjb2xsZWN0aW9uOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICBjb25zdCB0b3RhbENvdW50ID0gYXdhaXQgY291bnRUb3RhbChjb2xsZWN0aW9uKTtcbiAgY29uc3QgYXJ0aXN0c0RhdGEgPSBhd2FpdCBjb3VudFVuaXF1ZUFydGlzdHMoY29sbGVjdGlvbik7XG4gIGNvbnN0IHNhbXBsZUltYWdlcyA9IGF3YWl0IGxpc3RJbWFnZXMoY29sbGVjdGlvbiwgNSk7XG5cbiAgcmV0dXJuIHtcbiAgICB0b3RhbF9pbWFnZXM6IHRvdGFsQ291bnQuY291bnQsXG4gICAgdW5pcXVlX2FydGlzdHM6IGFydGlzdHNEYXRhLmNvdW50LFxuICAgIHNhbXBsZV9hcnRpc3RzOiBhcnRpc3RzRGF0YS5hcnRpc3RzLnNsaWNlKDAsIDEwKSxcbiAgICBzYW1wbGVfaW1hZ2VzOiBzYW1wbGVJbWFnZXMuaW1hZ2VzLFxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVJlc3BvbnNlKFxuICBxdWVzdGlvbjogc3RyaW5nLFxuICBpbnRlbnQ6IFF1ZXJ5SW50ZW50LFxuICBkYXRhOiBhbnksXG4gIHByb3ZpZGVyOiBFbWJlZGRpbmdQcm92aWRlclxuKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgY29uc3QgZmFsbGJhY2tSZXNwb25zZSA9IGdlbmVyYXRlRmFsbGJhY2tSZXNwb25zZShxdWVzdGlvbiwgaW50ZW50LCBkYXRhKTtcblxuICBpZiAoIXByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZICYmICFwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWSkge1xuICAgIHJldHVybiBmYWxsYmFja1Jlc3BvbnNlO1xuICB9XG5cbiAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gYFlvdSBhcmUgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IGV4cGxhaW5zIHZlY3RvciBkYXRhYmFzZSBxdWVyeSByZXN1bHRzIGluIG5hdHVyYWwgbGFuZ3VhZ2UuXG4gIFxuVGhlIHVzZXIgYXNrZWQ6IFwiJHtxdWVzdGlvbn1cIlxuVGhlIHF1ZXJ5IHR5cGUgd2FzOiAke2ludGVudC50eXBlfVxuVGhlIHF1ZXJ5IHNjb3BlIHdhczogJHtpbnRlbnQuc2NvcGV9XG5UaGUgZGF0YSByZXR1cm5lZCBpczogJHtKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKX1cblxuUHJvdmlkZSBhIGNvbmNpc2UsIG5hdHVyYWwgbGFuZ3VhZ2UgcmVzcG9uc2UgdGhhdCBkaXJlY3RseSBhbnN3ZXJzIHRoZSB1c2VyJ3MgcXVlc3Rpb24uIEJlIHNwZWNpZmljIHdpdGggbnVtYmVycyBhbmQgbmFtZXMgd2hlbiBhdmFpbGFibGUuYDtcblxuICB0cnkge1xuICAgIGxldCByZXNwb25zZTogc3RyaW5nO1xuXG4gICAgaWYgKHByb3ZpZGVyID09PSBcImdlbWluaVwiICYmIHByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZKSB7XG4gICAgICBjb25zdCBtb2RlbCA9IGdlbkFJLmdldEdlbmVyYXRpdmVNb2RlbCh7XG4gICAgICAgIG1vZGVsOiBcImdlbWluaS0yLjAtZmxhc2hcIiwgLy8gVXNlIHN0YWJsZSBHZW1pbmkgMi4wIEZsYXNoIG1vZGVsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vZGVsLmdlbmVyYXRlQ29udGVudChzeXN0ZW1Qcm9tcHQpO1xuICAgICAgcmVzcG9uc2UgPSByZXN1bHQucmVzcG9uc2UudGV4dCgpO1xuICAgIH0gZWxzZSBpZiAocHJvdmlkZXIgPT09IFwib3BlbmFpXCIgJiYgcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkpIHtcbiAgICAgIGNvbnN0IGNvbXBsZXRpb24gPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgICBtb2RlbDogXCJncHQtMy41LXR1cmJvXCIsXG4gICAgICAgIG1lc3NhZ2VzOiBbeyByb2xlOiBcInN5c3RlbVwiLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQgfV0sXG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjMsXG4gICAgICAgIG1heF90b2tlbnM6IDIwMCxcbiAgICAgIH0pO1xuICAgICAgcmVzcG9uc2UgPSBjb21wbGV0aW9uLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50IHx8IGZhbGxiYWNrUmVzcG9uc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxsYmFja1Jlc3BvbnNlO1xuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZS50cmltKCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKFwiRmFpbGVkIHRvIGdlbmVyYXRlIExMTSByZXNwb25zZSwgdXNpbmcgZmFsbGJhY2s6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsbGJhY2tSZXNwb25zZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZUZhbGxiYWNrUmVzcG9uc2UoXG4gIHF1ZXN0aW9uOiBzdHJpbmcsXG4gIGludGVudDogUXVlcnlJbnRlbnQsXG4gIGRhdGE6IGFueVxuKTogc3RyaW5nIHtcbiAgaWYgKGludGVudC5zY29wZSA9PT0gXCJkYXRhYmFzZVwiKSB7XG4gICAgc3dpdGNoIChpbnRlbnQudHlwZSkge1xuICAgICAgY2FzZSBcImNvdW50XCI6XG4gICAgICAgIGlmIChpbnRlbnQudGFyZ2V0ID09PSBcImNvbGxlY3Rpb25zXCIpIHtcbiAgICAgICAgICByZXR1cm4gYEkgZm91bmQgJHtkYXRhLmNvdW50IHx8IDB9IGNvbGxlY3Rpb25zIGluIHRoZSBkYXRhYmFzZTogJHtcbiAgICAgICAgICAgIGRhdGEuY29sbGVjdGlvbnM/LmpvaW4oXCIsIFwiKSB8fCBcIk5vbmUgZm91bmRcIlxuICAgICAgICAgIH0uYDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaW50ZW50LnRhcmdldCA9PT0gXCJhcnRpc3RzXCIpIHtcbiAgICAgICAgICByZXR1cm4gYEkgZm91bmQgJHtcbiAgICAgICAgICAgIGRhdGEuY291bnQgfHwgMFxuICAgICAgICAgIH0gdW5pcXVlIGFydGlzdHMgYWNyb3NzIGFsbCBjb2xsZWN0aW9ucy4gU29tZSBvZiB0aGVtIGluY2x1ZGU6ICR7XG4gICAgICAgICAgICBkYXRhLmFydGlzdHM/LnNsaWNlKDAsIDUpLmpvaW4oXCIsIFwiKSB8fCBcIk5vIGFydGlzdHMgZm91bmRcIlxuICAgICAgICAgIH0uYDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaW50ZW50LnRhcmdldCA9PT0gXCJ0b3RhbFwiKSB7XG4gICAgICAgICAgcmV0dXJuIGBUaGUgZGF0YWJhc2UgY29udGFpbnMgJHtcbiAgICAgICAgICAgIGRhdGEuY291bnQgfHwgMFxuICAgICAgICAgIH0gdG90YWwgdmVjdG9ycyBhY3Jvc3MgYWxsIGNvbGxlY3Rpb25zLmA7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiY29sbGVjdGlvbnNcIjpcbiAgICAgICAgcmV0dXJuIGBUaGUgZGF0YWJhc2UgY29udGFpbnMgJHtcbiAgICAgICAgICBkYXRhLmNvbGxlY3Rpb25zPy5sZW5ndGggfHwgMFxuICAgICAgICB9IGNvbGxlY3Rpb25zOiAke1xuICAgICAgICAgIGRhdGEuY29sbGVjdGlvbnNcbiAgICAgICAgICAgID8ubWFwKChjOiBhbnkpID0+IGAke2MubmFtZX0gKCR7Yy52ZWN0b3JzX2NvdW50IHx8IDB9IHZlY3RvcnMpYClcbiAgICAgICAgICAgIC5qb2luKFwiLCBcIikgfHwgXCJOb25lIGZvdW5kXCJcbiAgICAgICAgfS5gO1xuICAgICAgY2FzZSBcImRhdGFiYXNlXCI6XG4gICAgICAgIHJldHVybiBgVGhlIGRhdGFiYXNlIGNvbnRhaW5zICR7XG4gICAgICAgICAgZGF0YS50b3RhbF9jb2xsZWN0aW9ucyB8fCAwXG4gICAgICAgIH0gY29sbGVjdGlvbnMgd2l0aCBhIHRvdGFsIG9mICR7ZGF0YS50b3RhbF92ZWN0b3JzIHx8IDB9IHZlY3RvcnMuYDtcbiAgICAgIGNhc2UgXCJzZWFyY2hcIjpcbiAgICAgICAgcmV0dXJuIGBJIHNlYXJjaGVkIGFjcm9zcyAke1xuICAgICAgICAgIGRhdGEuY29sbGVjdGlvbnNfc2VhcmNoZWQgfHwgMFxuICAgICAgICB9IGNvbGxlY3Rpb25zIGFuZCBmb3VuZCAke2RhdGEudG90YWxfY291bnQgfHwgMH0gbWF0Y2hpbmcgaXRlbXMuYDtcbiAgICAgIGNhc2UgXCJsaXN0XCI6XG4gICAgICAgIGlmIChpbnRlbnQudGFyZ2V0ID09PSBcImFydGlzdHNcIikge1xuICAgICAgICAgIHJldHVybiBgSSBmb3VuZCAke1xuICAgICAgICAgICAgZGF0YS5hcnRpc3RzPy5sZW5ndGggfHwgMFxuICAgICAgICAgIH0gdW5pcXVlIGFydGlzdHMgYWNyb3NzIGFsbCBjb2xsZWN0aW9uczogJHtcbiAgICAgICAgICAgIGRhdGEuYXJ0aXN0cz8uc2xpY2UoMCwgMTApLmpvaW4oXCIsIFwiKSB8fCBcIk5vIGFydGlzdHMgZm91bmRcIlxuICAgICAgICAgIH0uYDtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICAvLyBDb2xsZWN0aW9uLWxldmVsIHJlc3BvbnNlcyAoZXhpc3RpbmcgbG9naWMpXG4gIHN3aXRjaCAoaW50ZW50LnR5cGUpIHtcbiAgICBjYXNlIFwiY291bnRcIjpcbiAgICAgIGlmIChpbnRlbnQudGFyZ2V0ID09PSBcImFydGlzdHNcIikge1xuICAgICAgICByZXR1cm4gYEkgZm91bmQgJHtcbiAgICAgICAgICBkYXRhLmNvdW50IHx8IDBcbiAgICAgICAgfSB1bmlxdWUgYXJ0aXN0cyBpbiB0aGUgY29sbGVjdGlvbi4gU29tZSBvZiB0aGVtIGluY2x1ZGU6ICR7XG4gICAgICAgICAgZGF0YS5hcnRpc3RzPy5zbGljZSgwLCA1KS5qb2luKFwiLCBcIikgfHwgXCJObyBhcnRpc3RzIGZvdW5kXCJcbiAgICAgICAgfS5gO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGBUaGUgY29sbGVjdGlvbiBjb250YWlucyAke2RhdGEuY291bnQgfHwgMH0gdG90YWwgaW1hZ2VzLmA7XG4gICAgICB9XG5cbiAgICBjYXNlIFwic2VhcmNoXCI6XG4gICAgY2FzZSBcImZpbHRlclwiOlxuICAgICAgcmV0dXJuIGBJIGZvdW5kICR7ZGF0YS5jb3VudCB8fCAwfSBpbWFnZXMgbWF0Y2hpbmcgeW91ciBjcml0ZXJpYS5gO1xuXG4gICAgY2FzZSBcImxpc3RcIjpcbiAgICAgIGlmIChpbnRlbnQudGFyZ2V0ID09PSBcImFydGlzdHNcIikge1xuICAgICAgICByZXR1cm4gYEhlcmUgYXJlIHRoZSBhcnRpc3RzIGluIHRoZSBjb2xsZWN0aW9uOiAke1xuICAgICAgICAgIGRhdGEuYXJ0aXN0cz8uc2xpY2UoMCwgMTApLmpvaW4oXCIsIFwiKSB8fCBcIk5vIGFydGlzdHMgZm91bmRcIlxuICAgICAgICB9JHtkYXRhLmFydGlzdHM/Lmxlbmd0aCA+IDEwID8gXCIuLi5cIiA6IFwiXCJ9LmA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYEkgZm91bmQgJHtkYXRhLmNvdW50IHx8IDB9IGl0ZW1zIGluIHRoZSBjb2xsZWN0aW9uLmA7XG4gICAgICB9XG5cbiAgICBjYXNlIFwiZGVzY3JpYmVcIjpcbiAgICAgIHJldHVybiBgVGhpcyBjb2xsZWN0aW9uIGNvbnRhaW5zICR7ZGF0YS50b3RhbF9pbWFnZXMgfHwgMH0gaW1hZ2VzIGZyb20gJHtcbiAgICAgICAgZGF0YS51bmlxdWVfYXJ0aXN0cyB8fCAwXG4gICAgICB9IHVuaXF1ZSBhcnRpc3RzLiBTb21lIGZlYXR1cmVkIGFydGlzdHMgaW5jbHVkZTogJHtcbiAgICAgICAgZGF0YS5zYW1wbGVfYXJ0aXN0cz8uc2xpY2UoMCwgNSkuam9pbihcIiwgXCIpIHx8IFwiTm8gYXJ0aXN0cyBmb3VuZFwiXG4gICAgICB9LmA7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIFwiSSBwcm9jZXNzZWQgeW91ciBxdWVyeSBzdWNjZXNzZnVsbHkgdXNpbmcgcGF0dGVybiBtYXRjaGluZy5cIjtcbiAgfVxufVxuXG4vLyBOZXcgZGF0YWJhc2UtbGV2ZWwgZnVuY3Rpb25zIGZvciBhcnRpc3RzIGFuZCB0b3RhbCBjb3VudHNcbmFzeW5jIGZ1bmN0aW9uIGNvdW50QXJ0aXN0c0Fjcm9zc0RhdGFiYXNlKCk6IFByb21pc2U8e1xuICBjb3VudDogbnVtYmVyO1xuICBhcnRpc3RzOiBzdHJpbmdbXTtcbn0+IHtcbiAgY29uc3QgY29sbGVjdGlvbnNEYXRhID0gYXdhaXQgbGlzdENvbGxlY3Rpb25zKCk7XG4gIGNvbnN0IGFsbEFydGlzdHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcblxuICAvLyBDb2xsZWN0IGFydGlzdHMgZnJvbSBlYWNoIGNvbGxlY3Rpb25cbiAgZm9yIChjb25zdCBjb2xsZWN0aW9uIG9mIGNvbGxlY3Rpb25zRGF0YS5jb2xsZWN0aW9ucykge1xuICAgIHRyeSB7XG4gICAgICBpZiAoY29sbGVjdGlvbi52ZWN0b3JzX2NvdW50ICYmIGNvbGxlY3Rpb24udmVjdG9yc19jb3VudCA+IDApIHtcbiAgICAgICAgY29uc3QgYXJ0aXN0c0RhdGEgPSBhd2FpdCBjb3VudFVuaXF1ZUFydGlzdHMoY29sbGVjdGlvbi5uYW1lKTtcbiAgICAgICAgYXJ0aXN0c0RhdGEuYXJ0aXN0cy5mb3JFYWNoKChhcnRpc3QpID0+IGFsbEFydGlzdHMuYWRkKGFydGlzdCkpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBGYWlsZWQgdG8gZ2V0IGFydGlzdHMgZnJvbSBjb2xsZWN0aW9uICR7Y29sbGVjdGlvbi5uYW1lfTpgLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGNvdW50OiBhbGxBcnRpc3RzLnNpemUsXG4gICAgYXJ0aXN0czogQXJyYXkuZnJvbShhbGxBcnRpc3RzKS5zbGljZSgwLCAyMCksIC8vIFNob3cgZmlyc3QgMjBcbiAgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gY291bnRUb3RhbFZlY3RvcnNBY3Jvc3NEYXRhYmFzZSgpOiBQcm9taXNlPHtcbiAgY291bnQ6IG51bWJlcjtcbiAgYnlfY29sbGVjdGlvbjogQXJyYXk8eyBuYW1lOiBzdHJpbmc7IGNvdW50OiBudW1iZXIgfT47XG59PiB7XG4gIGNvbnN0IGNvbGxlY3Rpb25zRGF0YSA9IGF3YWl0IGxpc3RDb2xsZWN0aW9ucygpO1xuICBjb25zdCB0b3RhbFZlY3RvcnMgPSBjb2xsZWN0aW9uc0RhdGEuY29sbGVjdGlvbnMucmVkdWNlKFxuICAgIChzdW0sIGNvbCkgPT4gc3VtICsgKGNvbC52ZWN0b3JzX2NvdW50IHx8IDApLFxuICAgIDBcbiAgKTtcblxuICByZXR1cm4ge1xuICAgIGNvdW50OiB0b3RhbFZlY3RvcnMsXG4gICAgYnlfY29sbGVjdGlvbjogY29sbGVjdGlvbnNEYXRhLmNvbGxlY3Rpb25zLm1hcCgoY29sKSA9PiAoe1xuICAgICAgbmFtZTogY29sLm5hbWUsXG4gICAgICBjb3VudDogY29sLnZlY3RvcnNfY291bnQgfHwgMCxcbiAgICB9KSksXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGxpc3RBcnRpc3RzQWNyb3NzRGF0YWJhc2UobGltaXQ6IG51bWJlcik6IFByb21pc2U8e1xuICBhcnRpc3RzOiBzdHJpbmdbXTtcbiAgYnlfY29sbGVjdGlvbjogQXJyYXk8eyBjb2xsZWN0aW9uOiBzdHJpbmc7IGFydGlzdHM6IHN0cmluZ1tdIH0+O1xufT4ge1xuICBjb25zdCBjb2xsZWN0aW9uc0RhdGEgPSBhd2FpdCBsaXN0Q29sbGVjdGlvbnMoKTtcbiAgY29uc3QgYWxsQXJ0aXN0cyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICBjb25zdCBieUNvbGxlY3Rpb246IEFycmF5PHsgY29sbGVjdGlvbjogc3RyaW5nOyBhcnRpc3RzOiBzdHJpbmdbXSB9PiA9IFtdO1xuXG4gIC8vIENvbGxlY3QgYXJ0aXN0cyBmcm9tIGVhY2ggY29sbGVjdGlvblxuICBmb3IgKGNvbnN0IGNvbGxlY3Rpb24gb2YgY29sbGVjdGlvbnNEYXRhLmNvbGxlY3Rpb25zKSB7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChjb2xsZWN0aW9uLnZlY3RvcnNfY291bnQgJiYgY29sbGVjdGlvbi52ZWN0b3JzX2NvdW50ID4gMCkge1xuICAgICAgICBjb25zdCBhcnRpc3RzRGF0YSA9IGF3YWl0IGxpc3RVbmlxdWVBcnRpc3RzKFxuICAgICAgICAgIGNvbGxlY3Rpb24ubmFtZSxcbiAgICAgICAgICBNYXRoLm1pbihsaW1pdCwgMjApXG4gICAgICAgICk7XG4gICAgICAgIGFydGlzdHNEYXRhLmFydGlzdHMuZm9yRWFjaCgoYXJ0aXN0KSA9PiBhbGxBcnRpc3RzLmFkZChhcnRpc3QpKTtcbiAgICAgICAgYnlDb2xsZWN0aW9uLnB1c2goe1xuICAgICAgICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb24ubmFtZSxcbiAgICAgICAgICBhcnRpc3RzOiBhcnRpc3RzRGF0YS5hcnRpc3RzLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgRmFpbGVkIHRvIGdldCBhcnRpc3RzIGZyb20gY29sbGVjdGlvbiAke2NvbGxlY3Rpb24ubmFtZX06YCxcbiAgICAgICAgZXJyb3JcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBhcnRpc3RzOiBBcnJheS5mcm9tKGFsbEFydGlzdHMpLnNsaWNlKDAsIGxpbWl0KSxcbiAgICBieV9jb2xsZWN0aW9uOiBieUNvbGxlY3Rpb24sXG4gIH07XG59XG4iXSwibmFtZXMiOlsiT3BlbkFJIiwiR29vZ2xlR2VuZXJhdGl2ZUFJIiwiY2xpZW50Iiwib3BlbmFpIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiZ2VuQUkiLCJHRU1JTklfQVBJX0tFWSIsInByb2Nlc3NOYXR1cmFsUXVlcnkiLCJjb2xsZWN0aW9uIiwicXVlc3Rpb24iLCJwcm92aWRlciIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJpbnRlbnQiLCJwYXJzZVF1ZXJ5SW50ZW50IiwiZmluYWxDb2xsZWN0aW9uIiwiZXh0cmFjdGVkQ29sbGVjdGlvbiIsInJlc3VsdCIsImV4ZWN1dGVRdWVyeSIsImFuc3dlciIsImdlbmVyYXRlUmVzcG9uc2UiLCJleGVjdXRpb25fdGltZV9tcyIsInF1ZXJ5X3R5cGUiLCJ0eXBlIiwiZGF0YSIsImVycm9yIiwiY29uc29sZSIsImZhbGxiYWNrQW5zd2VyIiwiZ2VuZXJhdGVGYWxsYmFja1Jlc3BvbnNlIiwiaW5mZXJJbnRlbnRGcm9tUXVlc3Rpb24iLCJjb3VudCIsImZhbGxiYWNrSW50ZW50IiwibG9nIiwic3lzdGVtUHJvbXB0IiwicmVzcG9uc2UiLCJtb2RlbCIsImdldEdlbmVyYXRpdmVNb2RlbCIsImdlbmVyYXRlQ29udGVudCIsInRleHQiLCJjb21wbGV0aW9uIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsInRlbXBlcmF0dXJlIiwiY2hvaWNlcyIsIm1lc3NhZ2UiLCJFcnJvciIsImpzb25NYXRjaCIsIm1hdGNoIiwianNvblN0ciIsIkpTT04iLCJwYXJzZSIsImUiLCJ3YXJuIiwicSIsInRvTG93ZXJDYXNlIiwiZXh0cmFjdENvbGxlY3Rpb25Gcm9tUXVlc3Rpb24iLCJpbmNsdWRlcyIsInRhcmdldCIsInNjb3BlIiwiYXJ0aXN0TWF0Y2giLCJmaWx0ZXIiLCJuYW1lIiwibGltaXQiLCJwYXR0ZXJucyIsInBhdHRlcm4iLCJtYXRjaGVzIiwibWF0Y2hBbGwiLCJjYW5kaWRhdGUiLCJjb21tb25Db2xsZWN0aW9uTmFtZXMiLCJ1bmRlZmluZWQiLCJleGVjdXRlRGF0YWJhc2VRdWVyeSIsImV4ZWN1dGVDb2xsZWN0aW9uUXVlcnkiLCJjb3VudENvbGxlY3Rpb25zIiwiY291bnRBcnRpc3RzQWNyb3NzRGF0YWJhc2UiLCJjb3VudFRvdGFsVmVjdG9yc0Fjcm9zc0RhdGFiYXNlIiwibGlzdENvbGxlY3Rpb25zIiwiZGVzY3JpYmVEYXRhYmFzZUluZm8iLCJzZWFyY2hBY3Jvc3NDb2xsZWN0aW9ucyIsImxpc3RBcnRpc3RzQWNyb3NzRGF0YWJhc2UiLCJjb3VudFVuaXF1ZUFydGlzdHMiLCJjb3VudFRvdGFsIiwic2VhcmNoSW1hZ2VzIiwibGlzdFVuaXF1ZUFydGlzdHMiLCJsaXN0SW1hZ2VzIiwiZmlsdGVySW1hZ2VzIiwiZGVzY3JpYmVDb2xsZWN0aW9uIiwiY29sbGVjdGlvbnNJbmZvIiwiZ2V0Q29sbGVjdGlvbnMiLCJjb2xsZWN0aW9ucyIsIm1hcCIsImMiLCJsZW5ndGgiLCJkZXRhaWxlZENvbGxlY3Rpb25zIiwiUHJvbWlzZSIsImFsbCIsImNvdW50UmVzdWx0IiwidmVjdG9yc19jb3VudCIsImNvbGxlY3Rpb25zRGF0YSIsInRvdGFsVmVjdG9ycyIsInJlZHVjZSIsInN1bSIsImNvbCIsInRvdGFsX2NvbGxlY3Rpb25zIiwidG90YWxfdmVjdG9ycyIsImFsbFJlc3VsdHMiLCJyZXN1bHRzIiwiaW1hZ2VzIiwicHVzaCIsInRvdGFsQ291bnQiLCJ0b3RhbF9jb3VudCIsImNvbGxlY3Rpb25zX3NlYXJjaGVkIiwicmVzdWx0c19ieV9jb2xsZWN0aW9uIiwic2Nyb2xsIiwid2l0aF9wYXlsb2FkIiwid2l0aF92ZWN0b3IiLCJhcnRpc3RzIiwiU2V0IiwicG9pbnRzIiwicG9pbnQiLCJwYXlsb2FkIiwiQm9vbGVhbiIsInNpemUiLCJBcnJheSIsImZyb20iLCJzbGljZSIsImZpbHRlcmVkUG9pbnRzIiwiT2JqZWN0IiwiZW50cmllcyIsImV2ZXJ5Iiwia2V5IiwidmFsdWUiLCJsaW1pdGVkUG9pbnRzIiwiaWQiLCJhcnRpc3QiLCJmaWxlbmFtZSIsImZpbGVfbmFtZSIsImFydGlzdHNEYXRhIiwic2FtcGxlSW1hZ2VzIiwidG90YWxfaW1hZ2VzIiwidW5pcXVlX2FydGlzdHMiLCJzYW1wbGVfYXJ0aXN0cyIsInNhbXBsZV9pbWFnZXMiLCJmYWxsYmFja1Jlc3BvbnNlIiwic3RyaW5naWZ5IiwibWF4X3Rva2VucyIsInRyaW0iLCJqb2luIiwiYWxsQXJ0aXN0cyIsImZvckVhY2giLCJhZGQiLCJieV9jb2xsZWN0aW9uIiwiYnlDb2xsZWN0aW9uIiwiTWF0aCIsIm1pbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/qdrant/nlp-query.ts\n");

/***/ }),

/***/ "(api)/./pages/api/ask.ts":
/*!**************************!*\
  !*** ./pages/api/ask.ts ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_qdrant_nlp_query__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/qdrant/nlp-query */ \"(api)/./lib/qdrant/nlp-query.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_qdrant_nlp_query__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_qdrant_nlp_query__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nasync function handler(req, res) {\n    // Enable CORS\n    res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n    res.setHeader(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS\");\n    res.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type\");\n    if (req.method === \"OPTIONS\") {\n        res.status(200).end();\n        return;\n    }\n    if (req.method !== \"POST\") {\n        res.setHeader(\"Allow\", [\n            \"POST\"\n        ]);\n        res.status(405).json({\n            error: `Method ${req.method} Not Allowed`\n        });\n        return;\n    }\n    try {\n        const { collection , question , provider  } = req.body;\n        if (!question) {\n            res.status(400).json({\n                error: \"Missing required field: question\"\n            });\n            return;\n        }\n        console.log(`Processing natural language query: \"${question}\" for collection: ${collection || \"database-level\"}`);\n        const result = await (0,_lib_qdrant_nlp_query__WEBPACK_IMPORTED_MODULE_0__.processNaturalQuery)(collection || null, question, provider || \"openai\");\n        // Transform the result to match NaturalQueryResponse interface\n        const response = {\n            question,\n            answer: result.answer,\n            query_type: result.query_type,\n            data: result.data,\n            execution_time_ms: result.execution_time_ms\n        };\n        res.status(200).json(response);\n    } catch (error) {\n        console.error(\"Error processing natural language query:\", error);\n        res.status(500).json({\n            error: error instanceof Error ? error.message : \"Internal server error\"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYXNrLnRzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQ2lFO0FBR2xELGVBQWVDLE9BQU8sQ0FDbkNDLEdBQW1CLEVBQ25CQyxHQUE4RCxFQUM5RDtJQUNBLGNBQWM7SUFDZEEsR0FBRyxDQUFDQyxTQUFTLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDbERELEdBQUcsQ0FBQ0MsU0FBUyxDQUFDLDhCQUE4QixFQUFFLG9CQUFvQixDQUFDLENBQUM7SUFDcEVELEdBQUcsQ0FBQ0MsU0FBUyxDQUFDLDhCQUE4QixFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBRTlELElBQUlGLEdBQUcsQ0FBQ0csTUFBTSxLQUFLLFNBQVMsRUFBRTtRQUM1QkYsR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLE9BQU87SUFDVCxDQUFDO0lBRUQsSUFBSUwsR0FBRyxDQUFDRyxNQUFNLEtBQUssTUFBTSxFQUFFO1FBQ3pCRixHQUFHLENBQUNDLFNBQVMsQ0FBQyxPQUFPLEVBQUU7WUFBQyxNQUFNO1NBQUMsQ0FBQyxDQUFDO1FBQ2pDRCxHQUFHLENBQUNHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0UsSUFBSSxDQUFDO1lBQUVDLEtBQUssRUFBRSxDQUFDLE9BQU8sRUFBRVAsR0FBRyxDQUFDRyxNQUFNLENBQUMsWUFBWSxDQUFDO1NBQUUsQ0FBQyxDQUFDO1FBQ3BFLE9BQU87SUFDVCxDQUFDO0lBRUQsSUFBSTtRQUNGLE1BQU0sRUFBRUssVUFBVSxHQUFFQyxRQUFRLEdBQUVDLFFBQVEsR0FBRSxHQUFHVixHQUFHLENBQUNXLElBQUk7UUFFbkQsSUFBSSxDQUFDRixRQUFRLEVBQUU7WUFDYlIsR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNFLElBQUksQ0FBQztnQkFDbkJDLEtBQUssRUFBRSxrQ0FBa0M7YUFDMUMsQ0FBQyxDQUFDO1lBQ0gsT0FBTztRQUNULENBQUM7UUFFREssT0FBTyxDQUFDQyxHQUFHLENBQ1QsQ0FBQyxvQ0FBb0MsRUFBRUosUUFBUSxDQUFDLGtCQUFrQixFQUNoRUQsVUFBVSxJQUFJLGdCQUFnQixDQUMvQixDQUFDLENBQ0gsQ0FBQztRQUVGLE1BQU1NLE1BQU0sR0FBRyxNQUFNaEIsMEVBQW1CLENBQ3RDVSxVQUFVLElBQUksSUFBSSxFQUNsQkMsUUFBUSxFQUNSQyxRQUFRLElBQUksUUFBUSxDQUNyQjtRQUVELCtEQUErRDtRQUMvRCxNQUFNSyxRQUFRLEdBQXlCO1lBQ3JDTixRQUFRO1lBQ1JPLE1BQU0sRUFBRUYsTUFBTSxDQUFDRSxNQUFNO1lBQ3JCQyxVQUFVLEVBQUVILE1BQU0sQ0FBQ0csVUFBVTtZQUM3QkMsSUFBSSxFQUFFSixNQUFNLENBQUNJLElBQUk7WUFDakJDLGlCQUFpQixFQUFFTCxNQUFNLENBQUNLLGlCQUFpQjtTQUM1QztRQUVEbEIsR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNFLElBQUksQ0FBQ1MsUUFBUSxDQUFDLENBQUM7SUFDakMsRUFBRSxPQUFPUixLQUFLLEVBQUU7UUFDZEssT0FBTyxDQUFDTCxLQUFLLENBQUMsMENBQTBDLEVBQUVBLEtBQUssQ0FBQyxDQUFDO1FBQ2pFTixHQUFHLENBQUNHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0UsSUFBSSxDQUFDO1lBQ25CQyxLQUFLLEVBQUVBLEtBQUssWUFBWWEsS0FBSyxHQUFHYixLQUFLLENBQUNjLE9BQU8sR0FBRyx1QkFBdUI7U0FDeEUsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95ZWFybi8uL3BhZ2VzL2FwaS9hc2sudHM/NjY0MyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tIFwibmV4dFwiO1xuaW1wb3J0IHsgcHJvY2Vzc05hdHVyYWxRdWVyeSB9IGZyb20gXCIuLi8uLi9saWIvcWRyYW50L25scC1xdWVyeVwiO1xuaW1wb3J0IHsgTmF0dXJhbFF1ZXJ5UmVxdWVzdCwgTmF0dXJhbFF1ZXJ5UmVzcG9uc2UgfSBmcm9tIFwiLi4vLi4vbGliL3R5cGVzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlPE5hdHVyYWxRdWVyeVJlc3BvbnNlIHwgeyBlcnJvcjogc3RyaW5nIH0+XG4pIHtcbiAgLy8gRW5hYmxlIENPUlNcbiAgcmVzLnNldEhlYWRlcihcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiLCBcIipcIik7XG4gIHJlcy5zZXRIZWFkZXIoXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzXCIsIFwiR0VULCBQT1NULCBPUFRJT05TXCIpO1xuICByZXMuc2V0SGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVyc1wiLCBcIkNvbnRlbnQtVHlwZVwiKTtcblxuICBpZiAocmVxLm1ldGhvZCA9PT0gXCJPUFRJT05TXCIpIHtcbiAgICByZXMuc3RhdHVzKDIwMCkuZW5kKCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHJlcS5tZXRob2QgIT09IFwiUE9TVFwiKSB7XG4gICAgcmVzLnNldEhlYWRlcihcIkFsbG93XCIsIFtcIlBPU1RcIl0pO1xuICAgIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6IGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IGNvbGxlY3Rpb24sIHF1ZXN0aW9uLCBwcm92aWRlciB9ID0gcmVxLmJvZHkgYXMgTmF0dXJhbFF1ZXJ5UmVxdWVzdDtcblxuICAgIGlmICghcXVlc3Rpb24pIHtcbiAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IFwiTWlzc2luZyByZXF1aXJlZCBmaWVsZDogcXVlc3Rpb25cIixcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYFByb2Nlc3NpbmcgbmF0dXJhbCBsYW5ndWFnZSBxdWVyeTogXCIke3F1ZXN0aW9ufVwiIGZvciBjb2xsZWN0aW9uOiAke1xuICAgICAgICBjb2xsZWN0aW9uIHx8IFwiZGF0YWJhc2UtbGV2ZWxcIlxuICAgICAgfWBcbiAgICApO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvY2Vzc05hdHVyYWxRdWVyeShcbiAgICAgIGNvbGxlY3Rpb24gfHwgbnVsbCwgLy8gQWxsb3cgbnVsbCBmb3IgZGF0YWJhc2UtbGV2ZWwgcXVlcmllc1xuICAgICAgcXVlc3Rpb24sXG4gICAgICBwcm92aWRlciB8fCBcIm9wZW5haVwiXG4gICAgKTtcblxuICAgIC8vIFRyYW5zZm9ybSB0aGUgcmVzdWx0IHRvIG1hdGNoIE5hdHVyYWxRdWVyeVJlc3BvbnNlIGludGVyZmFjZVxuICAgIGNvbnN0IHJlc3BvbnNlOiBOYXR1cmFsUXVlcnlSZXNwb25zZSA9IHtcbiAgICAgIHF1ZXN0aW9uLFxuICAgICAgYW5zd2VyOiByZXN1bHQuYW5zd2VyLFxuICAgICAgcXVlcnlfdHlwZTogcmVzdWx0LnF1ZXJ5X3R5cGUsXG4gICAgICBkYXRhOiByZXN1bHQuZGF0YSxcbiAgICAgIGV4ZWN1dGlvbl90aW1lX21zOiByZXN1bHQuZXhlY3V0aW9uX3RpbWVfbXMsXG4gICAgfTtcblxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHJlc3BvbnNlKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcHJvY2Vzc2luZyBuYXR1cmFsIGxhbmd1YWdlIHF1ZXJ5OlwiLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcIixcbiAgICB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbInByb2Nlc3NOYXR1cmFsUXVlcnkiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwic2V0SGVhZGVyIiwibWV0aG9kIiwic3RhdHVzIiwiZW5kIiwianNvbiIsImVycm9yIiwiY29sbGVjdGlvbiIsInF1ZXN0aW9uIiwicHJvdmlkZXIiLCJib2R5IiwiY29uc29sZSIsImxvZyIsInJlc3VsdCIsInJlc3BvbnNlIiwiYW5zd2VyIiwicXVlcnlfdHlwZSIsImRhdGEiLCJleGVjdXRpb25fdGltZV9tcyIsIkVycm9yIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/ask.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/ask.ts"));
module.exports = __webpack_exports__;

})();