"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/ask";
exports.ids = ["pages/api/ask"];
exports.modules = {

/***/ "@google/generative-ai":
/*!****************************************!*\
  !*** external "@google/generative-ai" ***!
  \****************************************/
/***/ ((module) => {

module.exports = import("@google/generative-ai");;

/***/ }),

/***/ "@qdrant/js-client-rest":
/*!*****************************************!*\
  !*** external "@qdrant/js-client-rest" ***!
  \*****************************************/
/***/ ((module) => {

module.exports = import("@qdrant/js-client-rest");;

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "(api)/./lib/qdrant/db.ts":
/*!**************************!*\
  !*** ./lib/qdrant/db.ts ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"client\": () => (/* binding */ client),\n/* harmony export */   \"createCollection\": () => (/* binding */ createCollection),\n/* harmony export */   \"testConnection\": () => (/* binding */ testConnection)\n/* harmony export */ });\n/* harmony import */ var _qdrant_js_client_rest__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @qdrant/js-client-rest */ \"@qdrant/js-client-rest\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_qdrant_js_client_rest__WEBPACK_IMPORTED_MODULE_0__]);\n_qdrant_js_client_rest__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n// Initialize client with support for both local and cloud instances\nconst qdrantUrl = \"https://1555b3af-2ea7-409c-83a3-3a49207ac217.us-east4-0.gcp.cloud.qdrant.io:6333\" || 0;\nconst qdrantApiKey = process.env.QDRANT_API_KEY;\nlet clientConfig;\n// For cloud instances, use the recommended format from documentation\nif (qdrantApiKey) {\n    // Parse the URL to extract host\n    const url = new URL(qdrantUrl);\n    const host = url.hostname;\n    const isHttps = url.protocol === \"https:\";\n    clientConfig = {\n        host: host,\n        port: null,\n        https: isHttps,\n        apiKey: qdrantApiKey\n    };\n    console.log(`Connecting to Qdrant Cloud at ${host} (HTTPS: ${isHttps})`);\n} else {\n    // For local instances without API key\n    clientConfig = {\n        url: qdrantUrl\n    };\n    console.log(`Connecting to local Qdrant at ${qdrantUrl}`);\n}\nconst client = new _qdrant_js_client_rest__WEBPACK_IMPORTED_MODULE_0__.QdrantClient(clientConfig);\n\n// Test Qdrant connection\nasync function testConnection() {\n    try {\n        // Use getCollections as a simple health check\n        await client.getCollections();\n        console.log(\"Qdrant connection successful\");\n        return true;\n    } catch (error) {\n        console.error(\"Qdrant connection failed:\", error);\n        return false;\n    }\n}\nasync function createCollection(name = \"my_collection\", dimension = 768) {\n    try {\n        // First test the connection\n        const isConnected = await testConnection();\n        if (!isConnected) {\n            throw new Error(\"Cannot connect to Qdrant database. Please check your configuration.\");\n        }\n        // Check if collection already exists\n        try {\n            await client.getCollection(name);\n            console.log(`Collection \"${name}\" already exists`);\n            return;\n        } catch (error) {\n            // Collection doesn't exist, create it\n            console.log(`Collection \"${name}\" does not exist, creating...`);\n            // Check if it's a different error than \"not found\"\n            if (error.status && error.status !== 404) {\n                console.error(\"Unexpected error checking collection:\", error);\n                throw error;\n            }\n        }\n        await client.createCollection(name, {\n            vectors: {\n                size: dimension,\n                distance: \"Cosine\"\n            }\n        });\n        console.log(`Collection \"${name}\" created successfully with dimension ${dimension}`);\n    } catch (error1) {\n        console.error(`Error creating collection \"${name}\":`, error1);\n        // Provide more specific error messages\n        if (error1.message?.includes(\"authentication\") || error1.status === 401 || error1.status === 403) {\n            throw new Error(\"Authentication failed. Please check your QDRANT_API_KEY and QDRANT_URL.\");\n        } else if (error1.message?.includes(\"connection\") || error1.code === \"ECONNREFUSED\") {\n            throw new Error(\"Cannot connect to Qdrant. Please check your QDRANT_URL.\");\n        } else {\n            throw error1;\n        }\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q2xDTSxPQUFPLEVBQUU7Z0JBQ1BDLElBQUksRUFBRU4sU0FBUztnQkFDZk8sUUFBUSxFQUFFLFFBQVE7YUFDbkI7U0FDRixDQUFDLENBQUM7UUFFSGYsT0FBTyxDQUFDQyxHQUFHLENBQ1QsQ0FBQyxZQUFZLEVBQUVNLElBQUksQ0FBQyxzQ0FBc0MsRUFBRUMsU0FBUyxDQUFDLENBQUMsQ0FDeEUsQ0FBQztJQUNKLEVBQUUsT0FBT0gsTUFBSyxFQUFPO1FBQ25CTCxPQUFPLENBQUNLLEtBQUssQ0FBQyxDQUFDLDJCQUEyQixFQUFFRSxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUVGLE1BQUssQ0FBQyxDQUFDO1FBRTdELHVDQUF1QztRQUN2QyxJQUNFQSxNQUFLLENBQUNXLE9BQU8sRUFBRUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLElBQ3pDWixNQUFLLENBQUNPLE1BQU0sS0FBSyxHQUFHLElBQ3BCUCxNQUFLLENBQUNPLE1BQU0sS0FBSyxHQUFHLEVBQ3BCO1lBQ0EsTUFBTSxJQUFJRixLQUFLLENBQ2IseUVBQXlFLENBQzFFLENBQUM7UUFDSixPQUFPLElBQ0xMLE1BQUssQ0FBQ1csT0FBTyxFQUFFQyxRQUFRLENBQUMsWUFBWSxDQUFDLElBQ3JDWixNQUFLLENBQUNhLElBQUksS0FBSyxjQUFjLEVBQzdCO1lBQ0EsTUFBTSxJQUFJUixLQUFLLENBQ2IseURBQXlELENBQzFELENBQUM7UUFDSixPQUFPO1lBQ0wsTUFBTUwsTUFBSyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7QUFDSCxDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8veWVhcm4vLi9saWIvcWRyYW50L2RiLnRzPzM5NjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUWRyYW50Q2xpZW50IH0gZnJvbSBcIkBxZHJhbnQvanMtY2xpZW50LXJlc3RcIjtcblxuLy8gSW5pdGlhbGl6ZSBjbGllbnQgd2l0aCBzdXBwb3J0IGZvciBib3RoIGxvY2FsIGFuZCBjbG91ZCBpbnN0YW5jZXNcbmNvbnN0IHFkcmFudFVybCA9IHByb2Nlc3MuZW52LlFEUkFOVF9VUkwgfHwgXCJodHRwOi8vbG9jYWxob3N0OjYzMzNcIjtcbmNvbnN0IHFkcmFudEFwaUtleSA9IHByb2Nlc3MuZW52LlFEUkFOVF9BUElfS0VZO1xuXG5sZXQgY2xpZW50Q29uZmlnOiBhbnk7XG5cbi8vIEZvciBjbG91ZCBpbnN0YW5jZXMsIHVzZSB0aGUgcmVjb21tZW5kZWQgZm9ybWF0IGZyb20gZG9jdW1lbnRhdGlvblxuaWYgKHFkcmFudEFwaUtleSkge1xuICAvLyBQYXJzZSB0aGUgVVJMIHRvIGV4dHJhY3QgaG9zdFxuICBjb25zdCB1cmwgPSBuZXcgVVJMKHFkcmFudFVybCk7XG4gIGNvbnN0IGhvc3QgPSB1cmwuaG9zdG5hbWU7XG4gIGNvbnN0IGlzSHR0cHMgPSB1cmwucHJvdG9jb2wgPT09IFwiaHR0cHM6XCI7XG5cbiAgY2xpZW50Q29uZmlnID0ge1xuICAgIGhvc3Q6IGhvc3QsXG4gICAgcG9ydDogbnVsbCwgLy8gVGhpcyBpcyBjcml0aWNhbCBmb3IgY2xvdWQgaW5zdGFuY2VzIC0gcHJldmVudHMgOjYzMzMgYmVpbmcgYXBwZW5kZWRcbiAgICBodHRwczogaXNIdHRwcyxcbiAgICBhcGlLZXk6IHFkcmFudEFwaUtleSxcbiAgfTtcblxuICBjb25zb2xlLmxvZyhgQ29ubmVjdGluZyB0byBRZHJhbnQgQ2xvdWQgYXQgJHtob3N0fSAoSFRUUFM6ICR7aXNIdHRwc30pYCk7XG59IGVsc2Uge1xuICAvLyBGb3IgbG9jYWwgaW5zdGFuY2VzIHdpdGhvdXQgQVBJIGtleVxuICBjbGllbnRDb25maWcgPSB7XG4gICAgdXJsOiBxZHJhbnRVcmwsXG4gIH07XG5cbiAgY29uc29sZS5sb2coYENvbm5lY3RpbmcgdG8gbG9jYWwgUWRyYW50IGF0ICR7cWRyYW50VXJsfWApO1xufVxuXG5jb25zdCBjbGllbnQgPSBuZXcgUWRyYW50Q2xpZW50KGNsaWVudENvbmZpZyk7XG5cbmV4cG9ydCB7IGNsaWVudCB9O1xuXG4vLyBUZXN0IFFkcmFudCBjb25uZWN0aW9uXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdGVzdENvbm5lY3Rpb24oKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHRyeSB7XG4gICAgLy8gVXNlIGdldENvbGxlY3Rpb25zIGFzIGEgc2ltcGxlIGhlYWx0aCBjaGVja1xuICAgIGF3YWl0IGNsaWVudC5nZXRDb2xsZWN0aW9ucygpO1xuICAgIGNvbnNvbGUubG9nKFwiUWRyYW50IGNvbm5lY3Rpb24gc3VjY2Vzc2Z1bFwiKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiUWRyYW50IGNvbm5lY3Rpb24gZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb2xsZWN0aW9uKFxuICBuYW1lOiBzdHJpbmcgPSBcIm15X2NvbGxlY3Rpb25cIixcbiAgZGltZW5zaW9uOiBudW1iZXIgPSA3Njhcbik6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIC8vIEZpcnN0IHRlc3QgdGhlIGNvbm5lY3Rpb25cbiAgICBjb25zdCBpc0Nvbm5lY3RlZCA9IGF3YWl0IHRlc3RDb25uZWN0aW9uKCk7XG4gICAgaWYgKCFpc0Nvbm5lY3RlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkNhbm5vdCBjb25uZWN0IHRvIFFkcmFudCBkYXRhYmFzZS4gUGxlYXNlIGNoZWNrIHlvdXIgY29uZmlndXJhdGlvbi5cIlxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBjb2xsZWN0aW9uIGFscmVhZHkgZXhpc3RzXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGNsaWVudC5nZXRDb2xsZWN0aW9uKG5hbWUpO1xuICAgICAgY29uc29sZS5sb2coYENvbGxlY3Rpb24gXCIke25hbWV9XCIgYWxyZWFkeSBleGlzdHNgKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyBDb2xsZWN0aW9uIGRvZXNuJ3QgZXhpc3QsIGNyZWF0ZSBpdFxuICAgICAgY29uc29sZS5sb2coYENvbGxlY3Rpb24gXCIke25hbWV9XCIgZG9lcyBub3QgZXhpc3QsIGNyZWF0aW5nLi4uYCk7XG5cbiAgICAgIC8vIENoZWNrIGlmIGl0J3MgYSBkaWZmZXJlbnQgZXJyb3IgdGhhbiBcIm5vdCBmb3VuZFwiXG4gICAgICBpZiAoZXJyb3Iuc3RhdHVzICYmIGVycm9yLnN0YXR1cyAhPT0gNDA0KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmV4cGVjdGVkIGVycm9yIGNoZWNraW5nIGNvbGxlY3Rpb246XCIsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgfVxuXG4gICAgYXdhaXQgY2xpZW50LmNyZWF0ZUNvbGxlY3Rpb24obmFtZSwge1xuICAgICAgdmVjdG9yczoge1xuICAgICAgICBzaXplOiBkaW1lbnNpb24sXG4gICAgICAgIGRpc3RhbmNlOiBcIkNvc2luZVwiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYENvbGxlY3Rpb24gXCIke25hbWV9XCIgY3JlYXRlZCBzdWNjZXNzZnVsbHkgd2l0aCBkaW1lbnNpb24gJHtkaW1lbnNpb259YFxuICAgICk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKGBFcnJvciBjcmVhdGluZyBjb2xsZWN0aW9uIFwiJHtuYW1lfVwiOmAsIGVycm9yKTtcblxuICAgIC8vIFByb3ZpZGUgbW9yZSBzcGVjaWZpYyBlcnJvciBtZXNzYWdlc1xuICAgIGlmIChcbiAgICAgIGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKFwiYXV0aGVudGljYXRpb25cIikgfHxcbiAgICAgIGVycm9yLnN0YXR1cyA9PT0gNDAxIHx8XG4gICAgICBlcnJvci5zdGF0dXMgPT09IDQwM1xuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkF1dGhlbnRpY2F0aW9uIGZhaWxlZC4gUGxlYXNlIGNoZWNrIHlvdXIgUURSQU5UX0FQSV9LRVkgYW5kIFFEUkFOVF9VUkwuXCJcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKFwiY29ubmVjdGlvblwiKSB8fFxuICAgICAgZXJyb3IuY29kZSA9PT0gXCJFQ09OTlJFRlVTRURcIlxuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkNhbm5vdCBjb25uZWN0IHRvIFFkcmFudC4gUGxlYXNlIGNoZWNrIHlvdXIgUURSQU5UX1VSTC5cIlxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiUWRyYW50Q2xpZW50IiwicWRyYW50VXJsIiwicHJvY2VzcyIsImVudiIsIlFEUkFOVF9VUkwiLCJxZHJhbnRBcGlLZXkiLCJRRFJBTlRfQVBJX0tFWSIsImNsaWVudENvbmZpZyIsInVybCIsIlVSTCIsImhvc3QiLCJob3N0bmFtZSIsImlzSHR0cHMiLCJwcm90b2NvbCIsInBvcnQiLCJodHRwcyIsImFwaUtleSIsImNvbnNvbGUiLCJsb2ciLCJjbGllbnQiLCJ0ZXN0Q29ubmVjdGlvbiIsImdldENvbGxlY3Rpb25zIiwiZXJyb3IiLCJjcmVhdGVDb2xsZWN0aW9uIiwibmFtZSIsImRpbWVuc2lvbiIsImlzQ29ubmVjdGVkIiwiRXJyb3IiLCJnZXRDb2xsZWN0aW9uIiwic3RhdHVzIiwidmVjdG9ycyIsInNpemUiLCJkaXN0YW5jZSIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsImNvZGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/qdrant/db.ts\n");

/***/ }),

/***/ "(api)/./lib/qdrant/nlp-query.ts":
/*!*********************************!*\
  !*** ./lib/qdrant/nlp-query.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"processNaturalQuery\": () => (/* binding */ processNaturalQuery)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"openai\");\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @google/generative-ai */ \"@google/generative-ai\");\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./db */ \"(api)/./lib/qdrant/db.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_0__, _google_generative_ai__WEBPACK_IMPORTED_MODULE_1__, _db__WEBPACK_IMPORTED_MODULE_2__]);\n([openai__WEBPACK_IMPORTED_MODULE_0__, _google_generative_ai__WEBPACK_IMPORTED_MODULE_1__, _db__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\nconst genAI = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_1__.GoogleGenerativeAI(process.env.GEMINI_API_KEY || \"\");\nasync function processNaturalQuery(collection, question, provider = \"openai\") {\n    const startTime = Date.now();\n    try {\n        // Step 1: Understand the intent using LLM\n        const intent = await parseQueryIntent(question, provider);\n        // Step 2: Execute the appropriate Qdrant operation\n        const result = await executeQuery(collection, intent);\n        // Step 3: Generate natural language response\n        const answer = await generateResponse(question, intent, result, provider);\n        const execution_time_ms = Date.now() - startTime;\n        return {\n            answer,\n            query_type: intent.type,\n            data: result,\n            execution_time_ms\n        };\n    } catch (error) {\n        console.error(\"Error processing natural query:\", error);\n        // Create fallback response even if everything fails\n        const fallbackAnswer = \"I encountered an issue processing your query, but I'm using pattern matching to help. \" + generateFallbackResponse(question, inferIntentFromQuestion(question), {\n            count: 0\n        });\n        return {\n            answer: fallbackAnswer,\n            query_type: \"fallback\",\n            data: null,\n            execution_time_ms: Date.now() - startTime\n        };\n    }\n}\nasync function parseQueryIntent(question, provider) {\n    // First try simple pattern matching as fallback\n    const fallbackIntent = inferIntentFromQuestion(question);\n    // If we don't have API keys, use fallback\n    if (!process.env.OPENAI_API_KEY && !process.env.GEMINI_API_KEY) {\n        console.log(\"No API keys available, using pattern matching fallback\");\n        return fallbackIntent;\n    }\n    const systemPrompt = `You are a query analyzer for a vector database. Parse the user's question and return a JSON object with the query intent.\n\nThe database contains image data with these fields:\n- name (artist name)\n- file_name (image filename)\n- image_url (URL to image)\n- url (style URL)\n\nAvailable query types:\n- \"count\": count items (e.g., \"how many artists\", \"count images\")\n- \"search\": find specific items (e.g., \"find Chris Dyer images\")\n- \"list\": list unique values (e.g., \"list all artists\")\n- \"filter\": filter by criteria (e.g., \"images with .jpeg extension\")\n- \"describe\": get general info (e.g., \"describe this collection\")\n\nReturn ONLY a JSON object in this format:\n{\n  \"type\": \"count|search|list|filter|describe\",\n  \"target\": \"what to count/search/list (e.g., 'artists', 'images', 'total')\",\n  \"filter\": {\"field\": \"value\"} or null,\n  \"limit\": number or null\n}\n\nExamples:\n- \"How many artists?\" → {\"type\": \"count\", \"target\": \"artists\", \"filter\": null, \"limit\": null}\n- \"Find Chris Dyer images\" → {\"type\": \"search\", \"target\": \"images\", \"filter\": {\"name\": \"Chris Dyer\"}, \"limit\": 10}\n- \"List all artists\" → {\"type\": \"list\", \"target\": \"artists\", \"filter\": null, \"limit\": null}`;\n    try {\n        let response;\n        if (provider === \"gemini\" && process.env.GEMINI_API_KEY) {\n            const model = genAI.getGenerativeModel({\n                model: \"gemini-1.5-flash\"\n            });\n            const result = await model.generateContent([\n                {\n                    text: systemPrompt\n                },\n                {\n                    text: `Question: \"${question}\"`\n                }, \n            ]);\n            response = result.response.text();\n        } else if (provider === \"openai\" && process.env.OPENAI_API_KEY) {\n            const completion = await openai.chat.completions.create({\n                model: \"gpt-3.5-turbo\",\n                messages: [\n                    {\n                        role: \"system\",\n                        content: systemPrompt\n                    },\n                    {\n                        role: \"user\",\n                        content: `Question: \"${question}\"`\n                    }, \n                ],\n                temperature: 0\n            });\n            response = completion.choices[0].message.content || \"{}\";\n        } else {\n            throw new Error(\"No valid API key for the specified provider\");\n        }\n        // Extract JSON from response (in case there's extra text)\n        const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\n        const jsonStr = jsonMatch ? jsonMatch[0] : response;\n        return JSON.parse(jsonStr);\n    } catch (e) {\n        // Fallback parsing\n        console.warn(\"Failed to parse LLM response, using fallback:\", e);\n        return fallbackIntent;\n    }\n}\nfunction inferIntentFromQuestion(question) {\n    const q = question.toLowerCase();\n    if (q.includes(\"how many\") || q.includes(\"count\")) {\n        if (q.includes(\"artist\")) return {\n            type: \"count\",\n            target: \"artists\"\n        };\n        return {\n            type: \"count\",\n            target: \"total\"\n        };\n    }\n    if (q.includes(\"find\") || q.includes(\"search\")) {\n        // Try to extract artist name\n        const artistMatch = question.match(/(?:by|from|of)\\s+([A-Z][a-z]+\\s+[A-Z][a-z]+)/i);\n        if (artistMatch) {\n            return {\n                type: \"search\",\n                target: \"images\",\n                filter: {\n                    name: artistMatch[1]\n                },\n                limit: 10\n            };\n        }\n        return {\n            type: \"search\",\n            target: \"images\",\n            limit: 10\n        };\n    }\n    if (q.includes(\"list\") || q.includes(\"show\")) {\n        if (q.includes(\"artist\")) return {\n            type: \"list\",\n            target: \"artists\"\n        };\n        return {\n            type: \"list\",\n            target: \"images\",\n            limit: 20\n        };\n    }\n    return {\n        type: \"describe\",\n        target: \"collection\"\n    };\n}\nasync function executeQuery(collection, intent) {\n    switch(intent.type){\n        case \"count\":\n            if (intent.target === \"artists\") {\n                return await countUniqueArtists(collection);\n            } else {\n                return await countTotal(collection);\n            }\n        case \"search\":\n            return await searchImages(collection, intent.filter, intent.limit || 10);\n        case \"list\":\n            if (intent.target === \"artists\") {\n                return await listUniqueArtists(collection, intent.limit || 50);\n            } else {\n                return await listImages(collection, intent.limit || 20);\n            }\n        case \"filter\":\n            return await filterImages(collection, intent.filter, intent.limit || 20);\n        case \"describe\":\n            return await describeCollection(collection);\n        default:\n            throw new Error(`Unknown query type: ${intent.type}`);\n    }\n}\nasync function countTotal(collection) {\n    const response = await _db__WEBPACK_IMPORTED_MODULE_2__.client.count(collection, {});\n    return {\n        count: response.count\n    };\n}\nasync function countUniqueArtists(collection) {\n    // Get sample of images to count unique artists\n    const response = await _db__WEBPACK_IMPORTED_MODULE_2__.client.scroll(collection, {\n        limit: 1000,\n        with_payload: true,\n        with_vector: false\n    });\n    const artists = new Set(response.points.map((point)=>point.payload?.name).filter(Boolean));\n    return {\n        count: artists.size,\n        artists: Array.from(artists).slice(0, 20)\n    };\n}\nasync function searchImages(collection, filter, limit) {\n    // For now, let's get all images and filter in memory to avoid index requirements\n    const response = await _db__WEBPACK_IMPORTED_MODULE_2__.client.scroll(collection, {\n        limit: 1000,\n        with_payload: true,\n        with_vector: false\n    });\n    let filteredPoints = response.points;\n    // Apply filters in memory if provided\n    if (filter) {\n        filteredPoints = response.points.filter((point)=>{\n            return Object.entries(filter).every(([key, value])=>{\n                return point.payload?.[key] === value;\n            });\n        });\n    }\n    // Limit results\n    const limitedPoints = filteredPoints.slice(0, limit);\n    return {\n        count: limitedPoints.length,\n        images: limitedPoints\n    };\n}\nasync function listUniqueArtists(collection, limit) {\n    const response = await _db__WEBPACK_IMPORTED_MODULE_2__.client.scroll(collection, {\n        limit,\n        with_payload: true,\n        with_vector: false\n    });\n    const artists = new Set(response.points.map((point)=>point.payload?.name).filter(Boolean));\n    return {\n        artists: Array.from(artists)\n    };\n}\nasync function listImages(collection, limit) {\n    const response = await _db__WEBPACK_IMPORTED_MODULE_2__.client.scroll(collection, {\n        limit,\n        with_payload: true,\n        with_vector: false\n    });\n    return {\n        count: response.points.length,\n        images: response.points.map((point)=>({\n                id: point.id,\n                artist: point.payload?.name,\n                filename: point.payload?.file_name\n            }))\n    };\n}\nasync function filterImages(collection, filter, limit) {\n    return await searchImages(collection, filter, limit);\n}\nasync function describeCollection(collection) {\n    const totalCount = await countTotal(collection);\n    const artistsData = await countUniqueArtists(collection);\n    const sampleImages = await listImages(collection, 5);\n    return {\n        total_images: totalCount.count,\n        unique_artists: artistsData.count,\n        sample_artists: artistsData.artists.slice(0, 10),\n        sample_images: sampleImages.images\n    };\n}\nasync function generateResponse(question, intent, data, provider) {\n    // Simple fallback responses\n    const fallbackResponse = generateFallbackResponse(question, intent, data);\n    // If no API keys, use fallback\n    if (!process.env.OPENAI_API_KEY && !process.env.GEMINI_API_KEY) {\n        return fallbackResponse;\n    }\n    const systemPrompt = `You are a helpful assistant that explains database query results in natural language.\n  \nThe user asked: \"${question}\"\nThe query type was: ${intent.type}\nThe data returned is: ${JSON.stringify(data, null, 2)}\n\nProvide a concise, natural language response that directly answers the user's question. Be specific with numbers and names when available.`;\n    try {\n        let response;\n        if (provider === \"gemini\" && process.env.GEMINI_API_KEY) {\n            const model = genAI.getGenerativeModel({\n                model: \"gemini-1.5-flash\"\n            });\n            const result = await model.generateContent(systemPrompt);\n            response = result.response.text();\n        } else if (provider === \"openai\" && process.env.OPENAI_API_KEY) {\n            const completion = await openai.chat.completions.create({\n                model: \"gpt-3.5-turbo\",\n                messages: [\n                    {\n                        role: \"system\",\n                        content: systemPrompt\n                    }\n                ],\n                temperature: 0.3,\n                max_tokens: 200\n            });\n            response = completion.choices[0].message.content || fallbackResponse;\n        } else {\n            return fallbackResponse;\n        }\n        return response.trim();\n    } catch (error) {\n        console.warn(\"Failed to generate LLM response, using fallback:\", error);\n        return fallbackResponse;\n    }\n}\nfunction generateFallbackResponse(question, intent, data) {\n    switch(intent.type){\n        case \"count\":\n            if (intent.target === \"artists\") {\n                return `I found ${data.count || 0} unique artists in the collection. Some of them include: ${data.artists?.slice(0, 5).join(\", \") || \"No artists found\"}.`;\n            } else {\n                return `The collection contains ${data.count || 0} total images.`;\n            }\n        case \"search\":\n        case \"filter\":\n            return `I found ${data.count || 0} images matching your criteria.`;\n        case \"list\":\n            if (intent.target === \"artists\") {\n                return `Here are the artists in the collection: ${data.artists?.slice(0, 10).join(\", \") || \"No artists found\"}${data.artists?.length > 10 ? \"...\" : \"\"}.`;\n            } else {\n                return `I found ${data.count || 0} items in the collection.`;\n            }\n        case \"describe\":\n            return `This collection contains ${data.total_images || 0} images from ${data.unique_artists || 0} unique artists. Some featured artists include: ${data.sample_artists?.slice(0, 5).join(\", \") || \"No artists found\"}.`;\n        default:\n            return \"I processed your query successfully using pattern matching.\";\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU8sQ0FBQyx5QkFBeUIsRUFBRU4sSUFBSSxDQUFDOEUsWUFBWSxJQUFJLENBQUMsQ0FBQyxhQUFhLEVBQ3JFOUUsSUFBSSxDQUFDK0UsY0FBYyxJQUFJLENBQUMsQ0FDekIsZ0RBQWdELEVBQy9DL0UsSUFBSSxDQUFDZ0YsY0FBYyxFQUFFbkIsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQ3lCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxrQkFBa0IsQ0FDbEUsQ0FBQyxDQUFDLENBQUM7UUFFTjtZQUNFLE9BQU8sNkRBQTZELENBQUM7S0FDeEU7QUFDSCxDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8veWVhcm4vLi9saWIvcWRyYW50L25scC1xdWVyeS50cz80NzRiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBPcGVuQUkgZnJvbSBcIm9wZW5haVwiO1xuaW1wb3J0IHsgR29vZ2xlR2VuZXJhdGl2ZUFJIH0gZnJvbSBcIkBnb29nbGUvZ2VuZXJhdGl2ZS1haVwiO1xuaW1wb3J0IHsgY2xpZW50IH0gZnJvbSBcIi4vZGJcIjtcbmltcG9ydCB7IEVtYmVkZGluZ1Byb3ZpZGVyIH0gZnJvbSBcIi4uL3NjaGVtYXNcIjtcblxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG59KTtcblxuY29uc3QgZ2VuQUkgPSBuZXcgR29vZ2xlR2VuZXJhdGl2ZUFJKHByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZIHx8IFwiXCIpO1xuXG5pbnRlcmZhY2UgUXVlcnlJbnRlbnQge1xuICB0eXBlOiBcImNvdW50XCIgfCBcInNlYXJjaFwiIHwgXCJsaXN0XCIgfCBcImZpbHRlclwiIHwgXCJkZXNjcmliZVwiO1xuICB0YXJnZXQ6IHN0cmluZzsgLy8gd2hhdCB0byBjb3VudC9zZWFyY2gvbGlzdFxuICBmaWx0ZXI/OiBhbnk7IC8vIGFueSBmaWx0ZXJzIHRvIGFwcGx5XG4gIGxpbWl0PzogbnVtYmVyO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc05hdHVyYWxRdWVyeShcbiAgY29sbGVjdGlvbjogc3RyaW5nLFxuICBxdWVzdGlvbjogc3RyaW5nLFxuICBwcm92aWRlcjogRW1iZWRkaW5nUHJvdmlkZXIgPSBcIm9wZW5haVwiXG4pOiBQcm9taXNlPHtcbiAgYW5zd2VyOiBzdHJpbmc7XG4gIHF1ZXJ5X3R5cGU6IHN0cmluZztcbiAgZGF0YT86IGFueTtcbiAgZXhlY3V0aW9uX3RpbWVfbXM6IG51bWJlcjtcbn0+IHtcbiAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcblxuICB0cnkge1xuICAgIC8vIFN0ZXAgMTogVW5kZXJzdGFuZCB0aGUgaW50ZW50IHVzaW5nIExMTVxuICAgIGNvbnN0IGludGVudCA9IGF3YWl0IHBhcnNlUXVlcnlJbnRlbnQocXVlc3Rpb24sIHByb3ZpZGVyKTtcblxuICAgIC8vIFN0ZXAgMjogRXhlY3V0ZSB0aGUgYXBwcm9wcmlhdGUgUWRyYW50IG9wZXJhdGlvblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4ZWN1dGVRdWVyeShjb2xsZWN0aW9uLCBpbnRlbnQpO1xuXG4gICAgLy8gU3RlcCAzOiBHZW5lcmF0ZSBuYXR1cmFsIGxhbmd1YWdlIHJlc3BvbnNlXG4gICAgY29uc3QgYW5zd2VyID0gYXdhaXQgZ2VuZXJhdGVSZXNwb25zZShxdWVzdGlvbiwgaW50ZW50LCByZXN1bHQsIHByb3ZpZGVyKTtcblxuICAgIGNvbnN0IGV4ZWN1dGlvbl90aW1lX21zID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcblxuICAgIHJldHVybiB7XG4gICAgICBhbnN3ZXIsXG4gICAgICBxdWVyeV90eXBlOiBpbnRlbnQudHlwZSxcbiAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIGV4ZWN1dGlvbl90aW1lX21zLFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHByb2Nlc3NpbmcgbmF0dXJhbCBxdWVyeTpcIiwgZXJyb3IpO1xuXG4gICAgLy8gQ3JlYXRlIGZhbGxiYWNrIHJlc3BvbnNlIGV2ZW4gaWYgZXZlcnl0aGluZyBmYWlsc1xuICAgIGNvbnN0IGZhbGxiYWNrQW5zd2VyID1cbiAgICAgIFwiSSBlbmNvdW50ZXJlZCBhbiBpc3N1ZSBwcm9jZXNzaW5nIHlvdXIgcXVlcnksIGJ1dCBJJ20gdXNpbmcgcGF0dGVybiBtYXRjaGluZyB0byBoZWxwLiBcIiArXG4gICAgICBnZW5lcmF0ZUZhbGxiYWNrUmVzcG9uc2UocXVlc3Rpb24sIGluZmVySW50ZW50RnJvbVF1ZXN0aW9uKHF1ZXN0aW9uKSwge1xuICAgICAgICBjb3VudDogMCxcbiAgICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFuc3dlcjogZmFsbGJhY2tBbnN3ZXIsXG4gICAgICBxdWVyeV90eXBlOiBcImZhbGxiYWNrXCIsXG4gICAgICBkYXRhOiBudWxsLFxuICAgICAgZXhlY3V0aW9uX3RpbWVfbXM6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgfTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBwYXJzZVF1ZXJ5SW50ZW50KFxuICBxdWVzdGlvbjogc3RyaW5nLFxuICBwcm92aWRlcjogRW1iZWRkaW5nUHJvdmlkZXJcbik6IFByb21pc2U8UXVlcnlJbnRlbnQ+IHtcbiAgLy8gRmlyc3QgdHJ5IHNpbXBsZSBwYXR0ZXJuIG1hdGNoaW5nIGFzIGZhbGxiYWNrXG4gIGNvbnN0IGZhbGxiYWNrSW50ZW50ID0gaW5mZXJJbnRlbnRGcm9tUXVlc3Rpb24ocXVlc3Rpb24pO1xuXG4gIC8vIElmIHdlIGRvbid0IGhhdmUgQVBJIGtleXMsIHVzZSBmYWxsYmFja1xuICBpZiAoIXByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZICYmICFwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWSkge1xuICAgIGNvbnNvbGUubG9nKFwiTm8gQVBJIGtleXMgYXZhaWxhYmxlLCB1c2luZyBwYXR0ZXJuIG1hdGNoaW5nIGZhbGxiYWNrXCIpO1xuICAgIHJldHVybiBmYWxsYmFja0ludGVudDtcbiAgfVxuXG4gIGNvbnN0IHN5c3RlbVByb21wdCA9IGBZb3UgYXJlIGEgcXVlcnkgYW5hbHl6ZXIgZm9yIGEgdmVjdG9yIGRhdGFiYXNlLiBQYXJzZSB0aGUgdXNlcidzIHF1ZXN0aW9uIGFuZCByZXR1cm4gYSBKU09OIG9iamVjdCB3aXRoIHRoZSBxdWVyeSBpbnRlbnQuXG5cblRoZSBkYXRhYmFzZSBjb250YWlucyBpbWFnZSBkYXRhIHdpdGggdGhlc2UgZmllbGRzOlxuLSBuYW1lIChhcnRpc3QgbmFtZSlcbi0gZmlsZV9uYW1lIChpbWFnZSBmaWxlbmFtZSlcbi0gaW1hZ2VfdXJsIChVUkwgdG8gaW1hZ2UpXG4tIHVybCAoc3R5bGUgVVJMKVxuXG5BdmFpbGFibGUgcXVlcnkgdHlwZXM6XG4tIFwiY291bnRcIjogY291bnQgaXRlbXMgKGUuZy4sIFwiaG93IG1hbnkgYXJ0aXN0c1wiLCBcImNvdW50IGltYWdlc1wiKVxuLSBcInNlYXJjaFwiOiBmaW5kIHNwZWNpZmljIGl0ZW1zIChlLmcuLCBcImZpbmQgQ2hyaXMgRHllciBpbWFnZXNcIilcbi0gXCJsaXN0XCI6IGxpc3QgdW5pcXVlIHZhbHVlcyAoZS5nLiwgXCJsaXN0IGFsbCBhcnRpc3RzXCIpXG4tIFwiZmlsdGVyXCI6IGZpbHRlciBieSBjcml0ZXJpYSAoZS5nLiwgXCJpbWFnZXMgd2l0aCAuanBlZyBleHRlbnNpb25cIilcbi0gXCJkZXNjcmliZVwiOiBnZXQgZ2VuZXJhbCBpbmZvIChlLmcuLCBcImRlc2NyaWJlIHRoaXMgY29sbGVjdGlvblwiKVxuXG5SZXR1cm4gT05MWSBhIEpTT04gb2JqZWN0IGluIHRoaXMgZm9ybWF0Olxue1xuICBcInR5cGVcIjogXCJjb3VudHxzZWFyY2h8bGlzdHxmaWx0ZXJ8ZGVzY3JpYmVcIixcbiAgXCJ0YXJnZXRcIjogXCJ3aGF0IHRvIGNvdW50L3NlYXJjaC9saXN0IChlLmcuLCAnYXJ0aXN0cycsICdpbWFnZXMnLCAndG90YWwnKVwiLFxuICBcImZpbHRlclwiOiB7XCJmaWVsZFwiOiBcInZhbHVlXCJ9IG9yIG51bGwsXG4gIFwibGltaXRcIjogbnVtYmVyIG9yIG51bGxcbn1cblxuRXhhbXBsZXM6XG4tIFwiSG93IG1hbnkgYXJ0aXN0cz9cIiDihpIge1widHlwZVwiOiBcImNvdW50XCIsIFwidGFyZ2V0XCI6IFwiYXJ0aXN0c1wiLCBcImZpbHRlclwiOiBudWxsLCBcImxpbWl0XCI6IG51bGx9XG4tIFwiRmluZCBDaHJpcyBEeWVyIGltYWdlc1wiIOKGkiB7XCJ0eXBlXCI6IFwic2VhcmNoXCIsIFwidGFyZ2V0XCI6IFwiaW1hZ2VzXCIsIFwiZmlsdGVyXCI6IHtcIm5hbWVcIjogXCJDaHJpcyBEeWVyXCJ9LCBcImxpbWl0XCI6IDEwfVxuLSBcIkxpc3QgYWxsIGFydGlzdHNcIiDihpIge1widHlwZVwiOiBcImxpc3RcIiwgXCJ0YXJnZXRcIjogXCJhcnRpc3RzXCIsIFwiZmlsdGVyXCI6IG51bGwsIFwibGltaXRcIjogbnVsbH1gO1xuXG4gIHRyeSB7XG4gICAgbGV0IHJlc3BvbnNlOiBzdHJpbmc7XG5cbiAgICBpZiAocHJvdmlkZXIgPT09IFwiZ2VtaW5pXCIgJiYgcHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVkpIHtcbiAgICAgIGNvbnN0IG1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHtcbiAgICAgICAgbW9kZWw6IFwiZ2VtaW5pLTEuNS1mbGFzaFwiLCAvLyBVc2UgdmFsaWQgR2VtaW5pIG1vZGVsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vZGVsLmdlbmVyYXRlQ29udGVudChbXG4gICAgICAgIHsgdGV4dDogc3lzdGVtUHJvbXB0IH0sXG4gICAgICAgIHsgdGV4dDogYFF1ZXN0aW9uOiBcIiR7cXVlc3Rpb259XCJgIH0sXG4gICAgICBdKTtcbiAgICAgIHJlc3BvbnNlID0gcmVzdWx0LnJlc3BvbnNlLnRleHQoKTtcbiAgICB9IGVsc2UgaWYgKHByb3ZpZGVyID09PSBcIm9wZW5haVwiICYmIHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZKSB7XG4gICAgICBjb25zdCBjb21wbGV0aW9uID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgICAgbW9kZWw6IFwiZ3B0LTMuNS10dXJib1wiLFxuICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgIHsgcm9sZTogXCJzeXN0ZW1cIiwgY29udGVudDogc3lzdGVtUHJvbXB0IH0sXG4gICAgICAgICAgeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogYFF1ZXN0aW9uOiBcIiR7cXVlc3Rpb259XCJgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLFxuICAgICAgfSk7XG4gICAgICByZXNwb25zZSA9IGNvbXBsZXRpb24uY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQgfHwgXCJ7fVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyB2YWxpZCBBUEkga2V5IGZvciB0aGUgc3BlY2lmaWVkIHByb3ZpZGVyXCIpO1xuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgSlNPTiBmcm9tIHJlc3BvbnNlIChpbiBjYXNlIHRoZXJlJ3MgZXh0cmEgdGV4dClcbiAgICBjb25zdCBqc29uTWF0Y2ggPSByZXNwb25zZS5tYXRjaCgvXFx7W1xcc1xcU10qXFx9Lyk7XG4gICAgY29uc3QganNvblN0ciA9IGpzb25NYXRjaCA/IGpzb25NYXRjaFswXSA6IHJlc3BvbnNlO1xuICAgIHJldHVybiBKU09OLnBhcnNlKGpzb25TdHIpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gRmFsbGJhY2sgcGFyc2luZ1xuICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBwYXJzZSBMTE0gcmVzcG9uc2UsIHVzaW5nIGZhbGxiYWNrOlwiLCBlKTtcbiAgICByZXR1cm4gZmFsbGJhY2tJbnRlbnQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gaW5mZXJJbnRlbnRGcm9tUXVlc3Rpb24ocXVlc3Rpb246IHN0cmluZyk6IFF1ZXJ5SW50ZW50IHtcbiAgY29uc3QgcSA9IHF1ZXN0aW9uLnRvTG93ZXJDYXNlKCk7XG5cbiAgaWYgKHEuaW5jbHVkZXMoXCJob3cgbWFueVwiKSB8fCBxLmluY2x1ZGVzKFwiY291bnRcIikpIHtcbiAgICBpZiAocS5pbmNsdWRlcyhcImFydGlzdFwiKSkgcmV0dXJuIHsgdHlwZTogXCJjb3VudFwiLCB0YXJnZXQ6IFwiYXJ0aXN0c1wiIH07XG4gICAgcmV0dXJuIHsgdHlwZTogXCJjb3VudFwiLCB0YXJnZXQ6IFwidG90YWxcIiB9O1xuICB9XG5cbiAgaWYgKHEuaW5jbHVkZXMoXCJmaW5kXCIpIHx8IHEuaW5jbHVkZXMoXCJzZWFyY2hcIikpIHtcbiAgICAvLyBUcnkgdG8gZXh0cmFjdCBhcnRpc3QgbmFtZVxuICAgIGNvbnN0IGFydGlzdE1hdGNoID0gcXVlc3Rpb24ubWF0Y2goXG4gICAgICAvKD86Ynl8ZnJvbXxvZilcXHMrKFtBLVpdW2Etel0rXFxzK1tBLVpdW2Etel0rKS9pXG4gICAgKTtcbiAgICBpZiAoYXJ0aXN0TWF0Y2gpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwic2VhcmNoXCIsXG4gICAgICAgIHRhcmdldDogXCJpbWFnZXNcIixcbiAgICAgICAgZmlsdGVyOiB7IG5hbWU6IGFydGlzdE1hdGNoWzFdIH0sXG4gICAgICAgIGxpbWl0OiAxMCxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7IHR5cGU6IFwic2VhcmNoXCIsIHRhcmdldDogXCJpbWFnZXNcIiwgbGltaXQ6IDEwIH07XG4gIH1cblxuICBpZiAocS5pbmNsdWRlcyhcImxpc3RcIikgfHwgcS5pbmNsdWRlcyhcInNob3dcIikpIHtcbiAgICBpZiAocS5pbmNsdWRlcyhcImFydGlzdFwiKSkgcmV0dXJuIHsgdHlwZTogXCJsaXN0XCIsIHRhcmdldDogXCJhcnRpc3RzXCIgfTtcbiAgICByZXR1cm4geyB0eXBlOiBcImxpc3RcIiwgdGFyZ2V0OiBcImltYWdlc1wiLCBsaW1pdDogMjAgfTtcbiAgfVxuXG4gIHJldHVybiB7IHR5cGU6IFwiZGVzY3JpYmVcIiwgdGFyZ2V0OiBcImNvbGxlY3Rpb25cIiB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBleGVjdXRlUXVlcnkoXG4gIGNvbGxlY3Rpb246IHN0cmluZyxcbiAgaW50ZW50OiBRdWVyeUludGVudFxuKTogUHJvbWlzZTxhbnk+IHtcbiAgc3dpdGNoIChpbnRlbnQudHlwZSkge1xuICAgIGNhc2UgXCJjb3VudFwiOlxuICAgICAgaWYgKGludGVudC50YXJnZXQgPT09IFwiYXJ0aXN0c1wiKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb3VudFVuaXF1ZUFydGlzdHMoY29sbGVjdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYXdhaXQgY291bnRUb3RhbChjb2xsZWN0aW9uKTtcbiAgICAgIH1cblxuICAgIGNhc2UgXCJzZWFyY2hcIjpcbiAgICAgIHJldHVybiBhd2FpdCBzZWFyY2hJbWFnZXMoY29sbGVjdGlvbiwgaW50ZW50LmZpbHRlciwgaW50ZW50LmxpbWl0IHx8IDEwKTtcblxuICAgIGNhc2UgXCJsaXN0XCI6XG4gICAgICBpZiAoaW50ZW50LnRhcmdldCA9PT0gXCJhcnRpc3RzXCIpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGxpc3RVbmlxdWVBcnRpc3RzKGNvbGxlY3Rpb24sIGludGVudC5saW1pdCB8fCA1MCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYXdhaXQgbGlzdEltYWdlcyhjb2xsZWN0aW9uLCBpbnRlbnQubGltaXQgfHwgMjApO1xuICAgICAgfVxuXG4gICAgY2FzZSBcImZpbHRlclwiOlxuICAgICAgcmV0dXJuIGF3YWl0IGZpbHRlckltYWdlcyhjb2xsZWN0aW9uLCBpbnRlbnQuZmlsdGVyLCBpbnRlbnQubGltaXQgfHwgMjApO1xuXG4gICAgY2FzZSBcImRlc2NyaWJlXCI6XG4gICAgICByZXR1cm4gYXdhaXQgZGVzY3JpYmVDb2xsZWN0aW9uKGNvbGxlY3Rpb24pO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBxdWVyeSB0eXBlOiAke2ludGVudC50eXBlfWApO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNvdW50VG90YWwoY29sbGVjdGlvbjogc3RyaW5nKTogUHJvbWlzZTx7IGNvdW50OiBudW1iZXIgfT4ge1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5jb3VudChjb2xsZWN0aW9uLCB7fSk7XG4gIHJldHVybiB7IGNvdW50OiByZXNwb25zZS5jb3VudCB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBjb3VudFVuaXF1ZUFydGlzdHMoXG4gIGNvbGxlY3Rpb246IHN0cmluZ1xuKTogUHJvbWlzZTx7IGNvdW50OiBudW1iZXI7IGFydGlzdHM6IHN0cmluZ1tdIH0+IHtcbiAgLy8gR2V0IHNhbXBsZSBvZiBpbWFnZXMgdG8gY291bnQgdW5pcXVlIGFydGlzdHNcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuc2Nyb2xsKGNvbGxlY3Rpb24sIHtcbiAgICBsaW1pdDogMTAwMCwgLy8gQWRqdXN0IGJhc2VkIG9uIGNvbGxlY3Rpb24gc2l6ZVxuICAgIHdpdGhfcGF5bG9hZDogdHJ1ZSxcbiAgICB3aXRoX3ZlY3RvcjogZmFsc2UsXG4gIH0pO1xuXG4gIGNvbnN0IGFydGlzdHMgPSBuZXcgU2V0KFxuICAgIHJlc3BvbnNlLnBvaW50cy5tYXAoKHBvaW50OiBhbnkpID0+IHBvaW50LnBheWxvYWQ/Lm5hbWUpLmZpbHRlcihCb29sZWFuKVxuICApO1xuXG4gIHJldHVybiB7XG4gICAgY291bnQ6IGFydGlzdHMuc2l6ZSxcbiAgICBhcnRpc3RzOiBBcnJheS5mcm9tKGFydGlzdHMpLnNsaWNlKDAsIDIwKSwgLy8gU2hvdyBmaXJzdCAyMFxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hJbWFnZXMoXG4gIGNvbGxlY3Rpb246IHN0cmluZyxcbiAgZmlsdGVyOiBhbnksXG4gIGxpbWl0OiBudW1iZXJcbik6IFByb21pc2U8YW55PiB7XG4gIC8vIEZvciBub3csIGxldCdzIGdldCBhbGwgaW1hZ2VzIGFuZCBmaWx0ZXIgaW4gbWVtb3J5IHRvIGF2b2lkIGluZGV4IHJlcXVpcmVtZW50c1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5zY3JvbGwoY29sbGVjdGlvbiwge1xuICAgIGxpbWl0OiAxMDAwLCAvLyBHZXQgbW9yZSB0byBmaWx0ZXIgZnJvbVxuICAgIHdpdGhfcGF5bG9hZDogdHJ1ZSxcbiAgICB3aXRoX3ZlY3RvcjogZmFsc2UsXG4gIH0pO1xuXG4gIGxldCBmaWx0ZXJlZFBvaW50cyA9IHJlc3BvbnNlLnBvaW50cztcblxuICAvLyBBcHBseSBmaWx0ZXJzIGluIG1lbW9yeSBpZiBwcm92aWRlZFxuICBpZiAoZmlsdGVyKSB7XG4gICAgZmlsdGVyZWRQb2ludHMgPSByZXNwb25zZS5wb2ludHMuZmlsdGVyKChwb2ludDogYW55KSA9PiB7XG4gICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMoZmlsdGVyKS5ldmVyeSgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIHJldHVybiBwb2ludC5wYXlsb2FkPy5ba2V5XSA9PT0gdmFsdWU7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIExpbWl0IHJlc3VsdHNcbiAgY29uc3QgbGltaXRlZFBvaW50cyA9IGZpbHRlcmVkUG9pbnRzLnNsaWNlKDAsIGxpbWl0KTtcblxuICByZXR1cm4ge1xuICAgIGNvdW50OiBsaW1pdGVkUG9pbnRzLmxlbmd0aCxcbiAgICBpbWFnZXM6IGxpbWl0ZWRQb2ludHMsXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGxpc3RVbmlxdWVBcnRpc3RzKFxuICBjb2xsZWN0aW9uOiBzdHJpbmcsXG4gIGxpbWl0OiBudW1iZXJcbik6IFByb21pc2U8eyBhcnRpc3RzOiBzdHJpbmdbXSB9PiB7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LnNjcm9sbChjb2xsZWN0aW9uLCB7XG4gICAgbGltaXQsXG4gICAgd2l0aF9wYXlsb2FkOiB0cnVlLFxuICAgIHdpdGhfdmVjdG9yOiBmYWxzZSxcbiAgfSk7XG5cbiAgY29uc3QgYXJ0aXN0cyA9IG5ldyBTZXQoXG4gICAgcmVzcG9uc2UucG9pbnRzLm1hcCgocG9pbnQ6IGFueSkgPT4gcG9pbnQucGF5bG9hZD8ubmFtZSkuZmlsdGVyKEJvb2xlYW4pXG4gICk7XG5cbiAgcmV0dXJuIHsgYXJ0aXN0czogQXJyYXkuZnJvbShhcnRpc3RzKSB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBsaXN0SW1hZ2VzKGNvbGxlY3Rpb246IHN0cmluZywgbGltaXQ6IG51bWJlcik6IFByb21pc2U8YW55PiB7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LnNjcm9sbChjb2xsZWN0aW9uLCB7XG4gICAgbGltaXQsXG4gICAgd2l0aF9wYXlsb2FkOiB0cnVlLFxuICAgIHdpdGhfdmVjdG9yOiBmYWxzZSxcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBjb3VudDogcmVzcG9uc2UucG9pbnRzLmxlbmd0aCxcbiAgICBpbWFnZXM6IHJlc3BvbnNlLnBvaW50cy5tYXAoKHBvaW50OiBhbnkpID0+ICh7XG4gICAgICBpZDogcG9pbnQuaWQsXG4gICAgICBhcnRpc3Q6IHBvaW50LnBheWxvYWQ/Lm5hbWUsXG4gICAgICBmaWxlbmFtZTogcG9pbnQucGF5bG9hZD8uZmlsZV9uYW1lLFxuICAgIH0pKSxcbiAgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZmlsdGVySW1hZ2VzKFxuICBjb2xsZWN0aW9uOiBzdHJpbmcsXG4gIGZpbHRlcjogYW55LFxuICBsaW1pdDogbnVtYmVyXG4pOiBQcm9taXNlPGFueT4ge1xuICByZXR1cm4gYXdhaXQgc2VhcmNoSW1hZ2VzKGNvbGxlY3Rpb24sIGZpbHRlciwgbGltaXQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBkZXNjcmliZUNvbGxlY3Rpb24oY29sbGVjdGlvbjogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgY29uc3QgdG90YWxDb3VudCA9IGF3YWl0IGNvdW50VG90YWwoY29sbGVjdGlvbik7XG4gIGNvbnN0IGFydGlzdHNEYXRhID0gYXdhaXQgY291bnRVbmlxdWVBcnRpc3RzKGNvbGxlY3Rpb24pO1xuICBjb25zdCBzYW1wbGVJbWFnZXMgPSBhd2FpdCBsaXN0SW1hZ2VzKGNvbGxlY3Rpb24sIDUpO1xuXG4gIHJldHVybiB7XG4gICAgdG90YWxfaW1hZ2VzOiB0b3RhbENvdW50LmNvdW50LFxuICAgIHVuaXF1ZV9hcnRpc3RzOiBhcnRpc3RzRGF0YS5jb3VudCxcbiAgICBzYW1wbGVfYXJ0aXN0czogYXJ0aXN0c0RhdGEuYXJ0aXN0cy5zbGljZSgwLCAxMCksXG4gICAgc2FtcGxlX2ltYWdlczogc2FtcGxlSW1hZ2VzLmltYWdlcyxcbiAgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVSZXNwb25zZShcbiAgcXVlc3Rpb246IHN0cmluZyxcbiAgaW50ZW50OiBRdWVyeUludGVudCxcbiAgZGF0YTogYW55LFxuICBwcm92aWRlcjogRW1iZWRkaW5nUHJvdmlkZXJcbik6IFByb21pc2U8c3RyaW5nPiB7XG4gIC8vIFNpbXBsZSBmYWxsYmFjayByZXNwb25zZXNcbiAgY29uc3QgZmFsbGJhY2tSZXNwb25zZSA9IGdlbmVyYXRlRmFsbGJhY2tSZXNwb25zZShxdWVzdGlvbiwgaW50ZW50LCBkYXRhKTtcblxuICAvLyBJZiBubyBBUEkga2V5cywgdXNlIGZhbGxiYWNrXG4gIGlmICghcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkgJiYgIXByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZKSB7XG4gICAgcmV0dXJuIGZhbGxiYWNrUmVzcG9uc2U7XG4gIH1cblxuICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSBgWW91IGFyZSBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgZXhwbGFpbnMgZGF0YWJhc2UgcXVlcnkgcmVzdWx0cyBpbiBuYXR1cmFsIGxhbmd1YWdlLlxuICBcblRoZSB1c2VyIGFza2VkOiBcIiR7cXVlc3Rpb259XCJcblRoZSBxdWVyeSB0eXBlIHdhczogJHtpbnRlbnQudHlwZX1cblRoZSBkYXRhIHJldHVybmVkIGlzOiAke0pTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDIpfVxuXG5Qcm92aWRlIGEgY29uY2lzZSwgbmF0dXJhbCBsYW5ndWFnZSByZXNwb25zZSB0aGF0IGRpcmVjdGx5IGFuc3dlcnMgdGhlIHVzZXIncyBxdWVzdGlvbi4gQmUgc3BlY2lmaWMgd2l0aCBudW1iZXJzIGFuZCBuYW1lcyB3aGVuIGF2YWlsYWJsZS5gO1xuXG4gIHRyeSB7XG4gICAgbGV0IHJlc3BvbnNlOiBzdHJpbmc7XG5cbiAgICBpZiAocHJvdmlkZXIgPT09IFwiZ2VtaW5pXCIgJiYgcHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVkpIHtcbiAgICAgIGNvbnN0IG1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHtcbiAgICAgICAgbW9kZWw6IFwiZ2VtaW5pLTEuNS1mbGFzaFwiLCAvLyBVc2UgdmFsaWQgR2VtaW5pIG1vZGVsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vZGVsLmdlbmVyYXRlQ29udGVudChzeXN0ZW1Qcm9tcHQpO1xuICAgICAgcmVzcG9uc2UgPSByZXN1bHQucmVzcG9uc2UudGV4dCgpO1xuICAgIH0gZWxzZSBpZiAocHJvdmlkZXIgPT09IFwib3BlbmFpXCIgJiYgcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkpIHtcbiAgICAgIGNvbnN0IGNvbXBsZXRpb24gPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgICBtb2RlbDogXCJncHQtMy41LXR1cmJvXCIsXG4gICAgICAgIG1lc3NhZ2VzOiBbeyByb2xlOiBcInN5c3RlbVwiLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQgfV0sXG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjMsXG4gICAgICAgIG1heF90b2tlbnM6IDIwMCxcbiAgICAgIH0pO1xuICAgICAgcmVzcG9uc2UgPSBjb21wbGV0aW9uLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50IHx8IGZhbGxiYWNrUmVzcG9uc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxsYmFja1Jlc3BvbnNlO1xuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZS50cmltKCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKFwiRmFpbGVkIHRvIGdlbmVyYXRlIExMTSByZXNwb25zZSwgdXNpbmcgZmFsbGJhY2s6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsbGJhY2tSZXNwb25zZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZUZhbGxiYWNrUmVzcG9uc2UoXG4gIHF1ZXN0aW9uOiBzdHJpbmcsXG4gIGludGVudDogUXVlcnlJbnRlbnQsXG4gIGRhdGE6IGFueVxuKTogc3RyaW5nIHtcbiAgc3dpdGNoIChpbnRlbnQudHlwZSkge1xuICAgIGNhc2UgXCJjb3VudFwiOlxuICAgICAgaWYgKGludGVudC50YXJnZXQgPT09IFwiYXJ0aXN0c1wiKSB7XG4gICAgICAgIHJldHVybiBgSSBmb3VuZCAke1xuICAgICAgICAgIGRhdGEuY291bnQgfHwgMFxuICAgICAgICB9IHVuaXF1ZSBhcnRpc3RzIGluIHRoZSBjb2xsZWN0aW9uLiBTb21lIG9mIHRoZW0gaW5jbHVkZTogJHtcbiAgICAgICAgICBkYXRhLmFydGlzdHM/LnNsaWNlKDAsIDUpLmpvaW4oXCIsIFwiKSB8fCBcIk5vIGFydGlzdHMgZm91bmRcIlxuICAgICAgICB9LmA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYFRoZSBjb2xsZWN0aW9uIGNvbnRhaW5zICR7ZGF0YS5jb3VudCB8fCAwfSB0b3RhbCBpbWFnZXMuYDtcbiAgICAgIH1cblxuICAgIGNhc2UgXCJzZWFyY2hcIjpcbiAgICBjYXNlIFwiZmlsdGVyXCI6XG4gICAgICByZXR1cm4gYEkgZm91bmQgJHtkYXRhLmNvdW50IHx8IDB9IGltYWdlcyBtYXRjaGluZyB5b3VyIGNyaXRlcmlhLmA7XG5cbiAgICBjYXNlIFwibGlzdFwiOlxuICAgICAgaWYgKGludGVudC50YXJnZXQgPT09IFwiYXJ0aXN0c1wiKSB7XG4gICAgICAgIHJldHVybiBgSGVyZSBhcmUgdGhlIGFydGlzdHMgaW4gdGhlIGNvbGxlY3Rpb246ICR7XG4gICAgICAgICAgZGF0YS5hcnRpc3RzPy5zbGljZSgwLCAxMCkuam9pbihcIiwgXCIpIHx8IFwiTm8gYXJ0aXN0cyBmb3VuZFwiXG4gICAgICAgIH0ke2RhdGEuYXJ0aXN0cz8ubGVuZ3RoID4gMTAgPyBcIi4uLlwiIDogXCJcIn0uYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBgSSBmb3VuZCAke2RhdGEuY291bnQgfHwgMH0gaXRlbXMgaW4gdGhlIGNvbGxlY3Rpb24uYDtcbiAgICAgIH1cblxuICAgIGNhc2UgXCJkZXNjcmliZVwiOlxuICAgICAgcmV0dXJuIGBUaGlzIGNvbGxlY3Rpb24gY29udGFpbnMgJHtkYXRhLnRvdGFsX2ltYWdlcyB8fCAwfSBpbWFnZXMgZnJvbSAke1xuICAgICAgICBkYXRhLnVuaXF1ZV9hcnRpc3RzIHx8IDBcbiAgICAgIH0gdW5pcXVlIGFydGlzdHMuIFNvbWUgZmVhdHVyZWQgYXJ0aXN0cyBpbmNsdWRlOiAke1xuICAgICAgICBkYXRhLnNhbXBsZV9hcnRpc3RzPy5zbGljZSgwLCA1KS5qb2luKFwiLCBcIikgfHwgXCJObyBhcnRpc3RzIGZvdW5kXCJcbiAgICAgIH0uYDtcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gXCJJIHByb2Nlc3NlZCB5b3VyIHF1ZXJ5IHN1Y2Nlc3NmdWxseSB1c2luZyBwYXR0ZXJuIG1hdGNoaW5nLlwiO1xuICB9XG59XG4iXSwibmFtZXMiOlsiT3BlbkFJIiwiR29vZ2xlR2VuZXJhdGl2ZUFJIiwiY2xpZW50Iiwib3BlbmFpIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiZ2VuQUkiLCJHRU1JTklfQVBJX0tFWSIsInByb2Nlc3NOYXR1cmFsUXVlcnkiLCJjb2xsZWN0aW9uIiwicXVlc3Rpb24iLCJwcm92aWRlciIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJpbnRlbnQiLCJwYXJzZVF1ZXJ5SW50ZW50IiwicmVzdWx0IiwiZXhlY3V0ZVF1ZXJ5IiwiYW5zd2VyIiwiZ2VuZXJhdGVSZXNwb25zZSIsImV4ZWN1dGlvbl90aW1lX21zIiwicXVlcnlfdHlwZSIsInR5cGUiLCJkYXRhIiwiZXJyb3IiLCJjb25zb2xlIiwiZmFsbGJhY2tBbnN3ZXIiLCJnZW5lcmF0ZUZhbGxiYWNrUmVzcG9uc2UiLCJpbmZlckludGVudEZyb21RdWVzdGlvbiIsImNvdW50IiwiZmFsbGJhY2tJbnRlbnQiLCJsb2ciLCJzeXN0ZW1Qcm9tcHQiLCJyZXNwb25zZSIsIm1vZGVsIiwiZ2V0R2VuZXJhdGl2ZU1vZGVsIiwiZ2VuZXJhdGVDb250ZW50IiwidGV4dCIsImNvbXBsZXRpb24iLCJjaGF0IiwiY29tcGxldGlvbnMiLCJjcmVhdGUiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwidGVtcGVyYXR1cmUiLCJjaG9pY2VzIiwibWVzc2FnZSIsIkVycm9yIiwianNvbk1hdGNoIiwibWF0Y2giLCJqc29uU3RyIiwiSlNPTiIsInBhcnNlIiwiZSIsIndhcm4iLCJxIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsInRhcmdldCIsImFydGlzdE1hdGNoIiwiZmlsdGVyIiwibmFtZSIsImxpbWl0IiwiY291bnRVbmlxdWVBcnRpc3RzIiwiY291bnRUb3RhbCIsInNlYXJjaEltYWdlcyIsImxpc3RVbmlxdWVBcnRpc3RzIiwibGlzdEltYWdlcyIsImZpbHRlckltYWdlcyIsImRlc2NyaWJlQ29sbGVjdGlvbiIsInNjcm9sbCIsIndpdGhfcGF5bG9hZCIsIndpdGhfdmVjdG9yIiwiYXJ0aXN0cyIsIlNldCIsInBvaW50cyIsIm1hcCIsInBvaW50IiwicGF5bG9hZCIsIkJvb2xlYW4iLCJzaXplIiwiQXJyYXkiLCJmcm9tIiwic2xpY2UiLCJmaWx0ZXJlZFBvaW50cyIsIk9iamVjdCIsImVudHJpZXMiLCJldmVyeSIsImtleSIsInZhbHVlIiwibGltaXRlZFBvaW50cyIsImxlbmd0aCIsImltYWdlcyIsImlkIiwiYXJ0aXN0IiwiZmlsZW5hbWUiLCJmaWxlX25hbWUiLCJ0b3RhbENvdW50IiwiYXJ0aXN0c0RhdGEiLCJzYW1wbGVJbWFnZXMiLCJ0b3RhbF9pbWFnZXMiLCJ1bmlxdWVfYXJ0aXN0cyIsInNhbXBsZV9hcnRpc3RzIiwic2FtcGxlX2ltYWdlcyIsImZhbGxiYWNrUmVzcG9uc2UiLCJzdHJpbmdpZnkiLCJtYXhfdG9rZW5zIiwidHJpbSIsImpvaW4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/qdrant/nlp-query.ts\n");

/***/ }),

/***/ "(api)/./pages/api/ask.ts":
/*!**************************!*\
  !*** ./pages/api/ask.ts ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_qdrant_nlp_query__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/qdrant/nlp-query */ \"(api)/./lib/qdrant/nlp-query.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_qdrant_nlp_query__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_qdrant_nlp_query__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nasync function handler(req, res) {\n    // Enable CORS\n    res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n    res.setHeader(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS\");\n    res.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type\");\n    if (req.method === \"OPTIONS\") {\n        res.status(200).end();\n        return;\n    }\n    if (req.method !== \"POST\") {\n        res.setHeader(\"Allow\", [\n            \"POST\"\n        ]);\n        res.status(405).json({\n            error: `Method ${req.method} Not Allowed`\n        });\n        return;\n    }\n    try {\n        const { collection , question , provider  } = req.body;\n        if (!collection || !question) {\n            res.status(400).json({\n                error: \"Missing required fields: collection and question\"\n            });\n            return;\n        }\n        console.log(`Processing natural language query: \"${question}\" for collection: ${collection}`);\n        const result = await (0,_lib_qdrant_nlp_query__WEBPACK_IMPORTED_MODULE_0__.processNaturalQuery)(collection, question, provider || \"openai\");\n        // Transform the result to match NaturalQueryResponse interface\n        const response = {\n            question,\n            answer: result.answer,\n            query_type: result.query_type,\n            data: result.data,\n            execution_time_ms: result.execution_time_ms\n        };\n        res.status(200).json(response);\n    } catch (error) {\n        console.error(\"Error processing natural language query:\", error);\n        res.status(500).json({\n            error: error instanceof Error ? error.message : \"Internal server error\"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYXNrLnRzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQ2lFO0FBR2xELGVBQWVDLE9BQU8sQ0FDbkNDLEdBQW1CLEVBQ25CQyxHQUE4RCxFQUM5RDtJQUNBLGNBQWM7SUFDZEEsR0FBRyxDQUFDQyxTQUFTLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDbERELEdBQUcsQ0FBQ0MsU0FBUyxDQUFDLDhCQUE4QixFQUFFLG9CQUFvQixDQUFDLENBQUM7SUFDcEVELEdBQUcsQ0FBQ0MsU0FBUyxDQUFDLDhCQUE4QixFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBRTlELElBQUlGLEdBQUcsQ0FBQ0csTUFBTSxLQUFLLFNBQVMsRUFBRTtRQUM1QkYsR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLE9BQU87SUFDVCxDQUFDO0lBRUQsSUFBSUwsR0FBRyxDQUFDRyxNQUFNLEtBQUssTUFBTSxFQUFFO1FBQ3pCRixHQUFHLENBQUNDLFNBQVMsQ0FBQyxPQUFPLEVBQUU7WUFBQyxNQUFNO1NBQUMsQ0FBQyxDQUFDO1FBQ2pDRCxHQUFHLENBQUNHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0UsSUFBSSxDQUFDO1lBQUVDLEtBQUssRUFBRSxDQUFDLE9BQU8sRUFBRVAsR0FBRyxDQUFDRyxNQUFNLENBQUMsWUFBWSxDQUFDO1NBQUUsQ0FBQyxDQUFDO1FBQ3BFLE9BQU87SUFDVCxDQUFDO0lBRUQsSUFBSTtRQUNGLE1BQU0sRUFBRUssVUFBVSxHQUFFQyxRQUFRLEdBQUVDLFFBQVEsR0FBRSxHQUFHVixHQUFHLENBQUNXLElBQUk7UUFFbkQsSUFBSSxDQUFDSCxVQUFVLElBQUksQ0FBQ0MsUUFBUSxFQUFFO1lBQzVCUixHQUFHLENBQUNHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0UsSUFBSSxDQUFDO2dCQUNuQkMsS0FBSyxFQUFFLGtEQUFrRDthQUMxRCxDQUFDLENBQUM7WUFDSCxPQUFPO1FBQ1QsQ0FBQztRQUVESyxPQUFPLENBQUNDLEdBQUcsQ0FDVCxDQUFDLG9DQUFvQyxFQUFFSixRQUFRLENBQUMsa0JBQWtCLEVBQUVELFVBQVUsQ0FBQyxDQUFDLENBQ2pGLENBQUM7UUFFRixNQUFNTSxNQUFNLEdBQUcsTUFBTWhCLDBFQUFtQixDQUN0Q1UsVUFBVSxFQUNWQyxRQUFRLEVBQ1JDLFFBQVEsSUFBSSxRQUFRLENBQ3JCO1FBRUQsK0RBQStEO1FBQy9ELE1BQU1LLFFBQVEsR0FBeUI7WUFDckNOLFFBQVE7WUFDUk8sTUFBTSxFQUFFRixNQUFNLENBQUNFLE1BQU07WUFDckJDLFVBQVUsRUFBRUgsTUFBTSxDQUFDRyxVQUFVO1lBQzdCQyxJQUFJLEVBQUVKLE1BQU0sQ0FBQ0ksSUFBSTtZQUNqQkMsaUJBQWlCLEVBQUVMLE1BQU0sQ0FBQ0ssaUJBQWlCO1NBQzVDO1FBRURsQixHQUFHLENBQUNHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0UsSUFBSSxDQUFDUyxRQUFRLENBQUMsQ0FBQztJQUNqQyxFQUFFLE9BQU9SLEtBQUssRUFBRTtRQUNkSyxPQUFPLENBQUNMLEtBQUssQ0FBQywwQ0FBMEMsRUFBRUEsS0FBSyxDQUFDLENBQUM7UUFDakVOLEdBQUcsQ0FBQ0csTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDRSxJQUFJLENBQUM7WUFDbkJDLEtBQUssRUFBRUEsS0FBSyxZQUFZYSxLQUFLLEdBQUdiLEtBQUssQ0FBQ2MsT0FBTyxHQUFHLHVCQUF1QjtTQUN4RSxDQUFDLENBQUM7SUFDTCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3llYXJuLy4vcGFnZXMvYXBpL2Fzay50cz82NjQzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XG5pbXBvcnQgeyBwcm9jZXNzTmF0dXJhbFF1ZXJ5IH0gZnJvbSBcIi4uLy4uL2xpYi9xZHJhbnQvbmxwLXF1ZXJ5XCI7XG5pbXBvcnQgeyBOYXR1cmFsUXVlcnlSZXF1ZXN0LCBOYXR1cmFsUXVlcnlSZXNwb25zZSB9IGZyb20gXCIuLi8uLi9saWIvdHlwZXNcIjtcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihcbiAgcmVxOiBOZXh0QXBpUmVxdWVzdCxcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2U8TmF0dXJhbFF1ZXJ5UmVzcG9uc2UgfCB7IGVycm9yOiBzdHJpbmcgfT5cbikge1xuICAvLyBFbmFibGUgQ09SU1xuICByZXMuc2V0SGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCIsIFwiKlwiKTtcbiAgcmVzLnNldEhlYWRlcihcIkFjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHNcIiwgXCJHRVQsIFBPU1QsIE9QVElPTlNcIik7XG4gIHJlcy5zZXRIZWFkZXIoXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzXCIsIFwiQ29udGVudC1UeXBlXCIpO1xuXG4gIGlmIChyZXEubWV0aG9kID09PSBcIk9QVElPTlNcIikge1xuICAgIHJlcy5zdGF0dXMoMjAwKS5lbmQoKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAocmVxLm1ldGhvZCAhPT0gXCJQT1NUXCIpIHtcbiAgICByZXMuc2V0SGVhZGVyKFwiQWxsb3dcIiwgW1wiUE9TVFwiXSk7XG4gICAgcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogYE1ldGhvZCAke3JlcS5tZXRob2R9IE5vdCBBbGxvd2VkYCB9KTtcbiAgICByZXR1cm47XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHsgY29sbGVjdGlvbiwgcXVlc3Rpb24sIHByb3ZpZGVyIH0gPSByZXEuYm9keSBhcyBOYXR1cmFsUXVlcnlSZXF1ZXN0O1xuXG4gICAgaWYgKCFjb2xsZWN0aW9uIHx8ICFxdWVzdGlvbikge1xuICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogXCJNaXNzaW5nIHJlcXVpcmVkIGZpZWxkczogY29sbGVjdGlvbiBhbmQgcXVlc3Rpb25cIixcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYFByb2Nlc3NpbmcgbmF0dXJhbCBsYW5ndWFnZSBxdWVyeTogXCIke3F1ZXN0aW9ufVwiIGZvciBjb2xsZWN0aW9uOiAke2NvbGxlY3Rpb259YFxuICAgICk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm9jZXNzTmF0dXJhbFF1ZXJ5KFxuICAgICAgY29sbGVjdGlvbixcbiAgICAgIHF1ZXN0aW9uLFxuICAgICAgcHJvdmlkZXIgfHwgXCJvcGVuYWlcIlxuICAgICk7XG5cbiAgICAvLyBUcmFuc2Zvcm0gdGhlIHJlc3VsdCB0byBtYXRjaCBOYXR1cmFsUXVlcnlSZXNwb25zZSBpbnRlcmZhY2VcbiAgICBjb25zdCByZXNwb25zZTogTmF0dXJhbFF1ZXJ5UmVzcG9uc2UgPSB7XG4gICAgICBxdWVzdGlvbixcbiAgICAgIGFuc3dlcjogcmVzdWx0LmFuc3dlcixcbiAgICAgIHF1ZXJ5X3R5cGU6IHJlc3VsdC5xdWVyeV90eXBlLFxuICAgICAgZGF0YTogcmVzdWx0LmRhdGEsXG4gICAgICBleGVjdXRpb25fdGltZV9tczogcmVzdWx0LmV4ZWN1dGlvbl90aW1lX21zLFxuICAgIH07XG5cbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbihyZXNwb25zZSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHByb2Nlc3NpbmcgbmF0dXJhbCBsYW5ndWFnZSBxdWVyeTpcIiwgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiSW50ZXJuYWwgc2VydmVyIGVycm9yXCIsXG4gICAgfSk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJwcm9jZXNzTmF0dXJhbFF1ZXJ5IiwiaGFuZGxlciIsInJlcSIsInJlcyIsInNldEhlYWRlciIsIm1ldGhvZCIsInN0YXR1cyIsImVuZCIsImpzb24iLCJlcnJvciIsImNvbGxlY3Rpb24iLCJxdWVzdGlvbiIsInByb3ZpZGVyIiwiYm9keSIsImNvbnNvbGUiLCJsb2ciLCJyZXN1bHQiLCJyZXNwb25zZSIsImFuc3dlciIsInF1ZXJ5X3R5cGUiLCJkYXRhIiwiZXhlY3V0aW9uX3RpbWVfbXMiLCJFcnJvciIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/ask.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/ask.ts"));
module.exports = __webpack_exports__;

})();